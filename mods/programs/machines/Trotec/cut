{"modules":{"0.47383876715576023":{"definition":"//\n// distance transform \n//    assumes thresholded image, with zero intensity exterior\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2015,6\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'distance transform'\n//\n// initialization\n//\nvar init = function() {\n   }\n//\n// inputs\n//\nvar inputs = {\n   image:{type:'RGBA',\n      event:function(evt){\n         mod.input = evt.detail\n         var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.width = mod.input.width\n         ctx.canvas.height = mod.input.height \n         ctx.putImageData(mod.input,0,0)\n         distance_transform()}}}\n//\n// outputs\n//\nvar outputs = {\n   distances:{type:'F32',\n      event:function(){\n         mod.distances.height = mod.input.height\n         mod.distances.width = mod.input.width\n         mods.output(mod,'distances',mod.distances)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // view button\n   //\n   div.appendChild(document.createElement('br'))\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img,0,0)\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n// distance transform function\n//\nfunction distance_transform() {\n   var blob = new Blob(['('+worker.toString()+'())'])\n   var url = window.URL.createObjectURL(blob)\n   var webworker = new Worker(url)\n   webworker.addEventListener('message',function(evt) {\n      window.URL.revokeObjectURL(url)\n      var h = mod.img.height\n      var w = mod.img.width\n      mod.distances = new Float32Array(evt.data.buffer)\n      var imgbuf = new Uint8ClampedArray(h*w*4)\n      var dmax = -Number.MAX_VALUE\n      for (var y = 0; y < h; ++y) {\n         for (var x = 0; x < w; ++x) {\n            if (mod.distances[(h-1-y)*w+x] > dmax)\n               dmax = mod.distances[(h-1-y)*w+x]\n            }\n         }\n      var i\n      for (var y = 0; y < h; ++y) {\n         for (var x = 0; x < w; ++x) {\n            i = 255*mod.distances[(h-1-y)*w+x]/dmax\n            imgbuf[(h-1-y)*w*4+x*4+0] = i\n            imgbuf[(h-1-y)*w*4+x*4+1] = i\n            imgbuf[(h-1-y)*w*4+x*4+2] = i\n            imgbuf[(h-1-y)*w*4+x*4+3] = 255\n            }\n         }\n      var imgdata = new ImageData(imgbuf,w,h)\n      var ctx = mod.img.getContext(\"2d\")\n      ctx.putImageData(imgdata,0,0)\n      if (w > h) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-h/w)\n         var wd = mod.canvas.width\n         var hd = mod.canvas.width*h/w\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-w/h)\n         var y0 = 0\n         var wd = mod.canvas.height*w/h\n         var hd = mod.canvas.height\n         }\n      var ctx = mod.canvas.getContext(\"2d\")\n      ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n      ctx.drawImage(mod.img,x0,y0,wd,hd)\n      webworker.terminate()\n      outputs.distances.event()\n      })\n   var ctx = mod.canvas.getContext(\"2d\")\n   ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n   var ctx = mod.img.getContext(\"2d\")\n   ctx.putImageData(mod.input,0,0)\n   var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n   webworker.postMessage({\n      height:mod.input.height,width:mod.input.width,\n      buffer:img.data.buffer},\n      [img.data.buffer])\n   }\n//\n// distance transform worker\n//\nfunction worker() {\n   self.addEventListener('message',function(evt) {\n      var ny = evt.data.height\n      var nx = evt.data.width\n      var input = new Uint8ClampedArray(evt.data.buffer)\n      var output = new Float32Array(nx*ny)\n      function distance(g,x,y,i) {\n         return ((y-i)*(y-i)+g[i][x]*g[i][x])\n         }\n      function intersection(g,x,y0,y1) {\n         return ((g[y0][x]*g[y0][x]-g[y1][x]*g[y1][x]+y0*y0-y1*y1)/(2.0*(y0-y1)))\n         }\n      //\n      // allocate arrays\n      //\n      var g = []\n      for (var y = 0; y < ny; ++y)\n         g[y] = new Uint32Array(nx)\n      var h = []\n      for (var y = 0; y < ny; ++y)\n         h[y] = new Uint32Array(nx)\n      var distances = []\n      for (var y = 0; y < ny; ++y)\n         distances[y] = new Uint32Array(nx)\n      var starts = new Uint32Array(ny)\n      var minimums = new Uint32Array(ny)\n      var d\n      //\n      // column scan\n      //  \n      for (var y = 0; y < ny; ++y) {\n         //\n         // right pass\n         //\n         var closest = -nx\n         for (var x = 0; x < nx; ++x) {\n            if (input[(ny-1-y)*nx*4+x*4+0] != 0) {\n               g[y][x] = 0\n               closest = x\n               }\n            else\n               g[y][x] = (x-closest)\n            }\n         //\n         // left pass\n         //\n         closest = 2*nx\n         for (var x = (nx-1); x >= 0; --x) {\n            if (input[(ny-1-y)*nx*4+x*4+0] != 0)\n               closest = x\n            else {\n               d = (closest-x)\n               if (d < g[y][x])\n                  g[y][x] = d\n               }\n            }\n         }\n      //\n      // row scan\n      //\n      for (var x = 0; x < nx; ++x) {\n         var segment = 0\n         starts[0] = 0\n         minimums[0] = 0\n         //\n         // down \n         //\n         for (var y = 1; y < ny; ++y) {\n            while ((segment >= 0) &&\n               (distance(g,x,starts[segment],minimums[segment]) > distance(g,x,starts[segment],y)))\n               segment -= 1\n            if (segment < 0) {\n               segment = 0\n               minimums[0] = y\n               }\n            else {\n               newstart = 1+intersection(g,x,minimums[segment],y)\n               if (newstart < ny) {\n                  segment += 1\n                  minimums[segment] = y\n                  starts[segment] = newstart\n                  }\n               }\n            }\n         //\n         // up \n         //\n         for (var y = (ny-1); y >= 0; --y) {\n            d = Math.sqrt(distance(g,x,y,minimums[segment]))\n            output[(ny-1-y)*nx+x] = d\n            if (y == starts[segment])\n               segment -= 1\n            }\n         }\n      self.postMessage({buffer:output.buffer},[output.buffer])\n      })\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"449.90132715946083","left":"1935.351952550624","filename":"undefined","inputs":{},"outputs":{}},"0.07944144280928633":{"definition":"//\n// edge detect\n//    green = interior, blue = exterior, red = boundary\n//    assumes input is thresholded\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2015,6\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'edge detect'\n//\n// initialization\n//\nvar init = function() {\n   }\n//\n// inputs\n//\nvar inputs = {\n   image:{type:'RGBA',\n      event:function(evt){\n         mod.input = evt.detail\n         var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.width = mod.input.width\n         ctx.canvas.height = mod.input.height \n         ctx.putImageData(mod.input,0,0)\n         edge_detect()}}}\n//\n// outputs\n//\nvar outputs = {\n   image:{type:'RGBA',\n      event:function(){\n         var ctx = mod.img.getContext(\"2d\")\n         var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n         mods.output(mod,'image',img)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // view button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         win.document.body.appendChild(document.createTextNode('green:interior, blue:exterior, red:boundary'))\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img,0,0)\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n// edge detect\n//\nfunction edge_detect() {\n   var blob = new Blob(['('+worker.toString()+'())'])\n   var url = window.URL.createObjectURL(blob)\n   var webworker = new Worker(url)\n   webworker.addEventListener('message',function(evt) {\n      window.URL.revokeObjectURL(url)\n      var h = mod.img.height\n      var w = mod.img.width\n      var buf = new Uint8ClampedArray(evt.data.buffer)\n      var imgdata = new ImageData(buf,w,h)\n      var ctx = mod.img.getContext(\"2d\")\n      ctx.putImageData(imgdata,0,0)\n      if (w > h) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-h/w)\n         var wd = mod.canvas.width\n         var hd = mod.canvas.width*h/w\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-w/h)\n         var y0 = 0\n         var wd = mod.canvas.height*w/h\n         var hd = mod.canvas.height\n         }\n      var ctx = mod.canvas.getContext(\"2d\")\n      ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n      ctx.drawImage(mod.img,x0,y0,wd,hd)\n      webworker.terminate()\n      outputs.image.event()\n      })\n   var ctx = mod.canvas.getContext(\"2d\")\n   ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n   webworker.postMessage({worker:worker.toString(),\n      height:mod.input.height,width:mod.input.width,\n      buffer:mod.input.data.buffer},\n      [mod.input.data.buffer])\n   }\nfunction worker() {\n   self.addEventListener('message',function(evt) {\n      var h = evt.data.height\n      var w = evt.data.width\n      var input = new Uint8ClampedArray(evt.data.buffer)\n      var output = new Uint8ClampedArray(h*w*4)\n      var i00,i0m,i0p,im0,ip0,imm,imp,ipm,ipp,row,col\n      //\n      // find edges - interior\n      //\n      for (row = 1; row < (h-1); ++row) {\n         for (col = 1; col < (w-1); ++col) {\n            i00 = (input[(h-1-row)*w*4+col*4+0] \n                      +input[(h-1-row)*w*4+col*4+1] \n                      +input[(h-1-row)*w*4+col*4+2])\n            i0p = (input[(h-1-row)*w*4+(col+1)*4+0] \n                      +input[(h-1-row)*w*4+(col+1)*4+1] \n                      +input[(h-1-row)*w*4+(col+1)*4+2])\n            ip0 = (input[(h-2-row)*w*4+col*4+0] \n                      +input[(h-2-row)*w*4+col*4+1] \n                      +input[(h-2-row)*w*4+col*4+2])\n            ipp = (input[(h-2-row)*w*4+(col+1)*4+0] \n                      +input[(h-2-row)*w*4+(col+1)*4+1] \n                      +input[(h-2-row)*w*4+(col+1)*4+2])\n            i0m = (input[(h-1-row)*w*4+(col-1)*4+0] \n                      +input[(h-1-row)*w*4+(col-1)*4+1] \n                      +input[(h-1-row)*w*4+(col-1)*4+2])\n            im0 = (input[(h-row)*w*4+col*4+0] \n                      +input[(h-row)*w*4+col*4+1] \n                      +input[(h-row)*w*4+col*4+2])\n            imm = (input[(h-row)*w*4+(col-1)*4+0] \n                      +input[(h-row)*w*4+(col-1)*4+1] \n                      +input[(h-row)*w*4+(col-1)*4+2])\n            imp = (input[(h-row)*w*4+(col+1)*4+0] \n                      +input[(h-row)*w*4+(col+1)*4+1] \n                      +input[(h-row)*w*4+(col+1)*4+2])\n            ipm = (input[(h-2-row)*w*4+(col-1)*4+0] \n                      +input[(h-2-row)*w*4+(col-1)*4+1] \n                      +input[(h-2-row)*w*4+(col-1)*4+2])\n            if ((i00 != i0p) || (i00 != ip0) || (i00 != ipp) \n               || (i00 != i0m) || (i00 != im0) || (i00 != imm)\n               || (i00 != imp) || (i00 != ipm)) {\n               output[(h-1-row)*w*4+col*4+0] = 255\n               output[(h-1-row)*w*4+col*4+1] = 0\n               output[(h-1-row)*w*4+col*4+2] = 0\n               output[(h-1-row)*w*4+col*4+3] = 255\n               }\n            else if (i00 == 0) {\n               output[(h-1-row)*w*4+col*4+0] = 0\n               output[(h-1-row)*w*4+col*4+1] = 0\n               output[(h-1-row)*w*4+col*4+2] = 255\n               output[(h-1-row)*w*4+col*4+3] = 255\n               }\n            else {\n               output[(h-1-row)*w*4+col*4+0] = 0\n               output[(h-1-row)*w*4+col*4+1] = 255\n               output[(h-1-row)*w*4+col*4+2] = 0\n               output[(h-1-row)*w*4+col*4+3] = 255\n               }\n            }\n         }\n      //\n      // left and right edges\n      //\n      for (row = 1; row < (h-1); ++row) {\n         col = w-1\n         i00 = (input[(h-1-row)*w*4+col*4+0] \n                   +input[(h-1-row)*w*4+col*4+1] \n                   +input[(h-1-row)*w*4+col*4+2])\n         i0m = (input[(h-1-row)*w*4+(col-1)*4+0] \n                   +input[(h-1-row)*w*4+(col-1)*4+1] \n                   +input[(h-1-row)*w*4+(col-1)*4+2])\n         imm = (input[(h-row)*w*4+(col-1)*4+0] \n                   +input[(h-row)*w*4+(col-1)*4+1] \n                   +input[(h-row)*w*4+(col-1)*4+2])\n         ipm = (input[(h-2-row)*w*4+(col-1)*4+0] \n                   +input[(h-2-row)*w*4+(col-1)*4+1] \n                   +input[(h-2-row)*w*4+(col-1)*4+2])\n         im0 = (input[(h-row)*w*4+col*4+0] \n                   +input[(h-row)*w*4+col*4+1] \n                   +input[(h-row)*w*4+col*4+2])\n         ip0 = (input[(h-2-row)*w*4+col*4+0] \n                   +input[(h-2-row)*w*4+col*4+1] \n                   +input[(h-2-row)*w*4+col*4+2])\n        if ((i00 != i0m) || (i00 != ip0) || (i00 != ipm) \n           || (i00 != im0) || (i00 != imm)) {\n           output[(h-1-row)*w*4+col*4+0] = 255\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else if (i00 == 0) {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 255\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 255\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n         col = 0\n         i00 = (input[(h-1-row)*w*4+col*4+0] \n                   +input[(h-1-row)*w*4+col*4+1] \n                   +input[(h-1-row)*w*4+col*4+2])\n         i0p = (input[(h-1-row)*w*4+(col+1)*4+0] \n                   +input[(h-1-row)*w*4+(col+1)*4+1] \n                   +input[(h-1-row)*w*4+(col+1)*4+2])\n         imp = (input[(h-row)*w*4+(col+1)*4+0] \n                   +input[(h-row)*w*4+(col+1)*4+1] \n                   +input[(h-row)*w*4+(col+1)*4+2])\n         ipp = (input[(h-2-row)*w*4+(col+1)*4+0] \n                   +input[(h-2-row)*w*4+(col+1)*4+1] \n                   +input[(h-2-row)*w*4+(col+1)*4+2])\n         im0 = (input[(h-row)*w*4+col*4+0] \n                   +input[(h-row)*w*4+col*4+1] \n                   +input[(h-row)*w*4+col*4+2])\n         ip0 = (input[(h-2-row)*w*4+col*4+0] \n                   +input[(h-2-row)*w*4+col*4+1] \n                   +input[(h-2-row)*w*4+col*4+2])\n        if ((i00 != i0p) || (i00 != ip0) || (i00 != ipp) \n           || (i00 != im0) || (i00 != imp)) {\n           output[(h-1-row)*w*4+col*4+0] = 255\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else if (i00 == 0) {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 255\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 255\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n         }\n      //\n      // top and bottom edges\n      //\n      for (col = 1; col < (w-1); ++col) {\n         row = h-1\n         i00 = (input[(h-1-row)*w*4+col*4+0] \n                   +input[(h-1-row)*w*4+col*4+1] \n                   +input[(h-1-row)*w*4+col*4+2])\n         i0m = (input[(h-1-row)*w*4+(col-1)*4+0] \n                   +input[(h-1-row)*w*4+(col-1)*4+1] \n                   +input[(h-1-row)*w*4+(col-1)*4+2])\n         i0p = (input[(h-1-row)*w*4+(col+1)*4+0] \n                   +input[(h-1-row)*w*4+(col+1)*4+1] \n                   +input[(h-1-row)*w*4+(col+1)*4+2])\n         imm = (input[(h-row)*w*4+(col-1)*4+0] \n                   +input[(h-row)*w*4+(col-1)*4+1] \n                   +input[(h-row)*w*4+(col-1)*4+2])\n         im0 = (input[(h-row)*w*4+col*4+0] \n                   +input[(h-row)*w*4+col*4+1] \n                   +input[(h-row)*w*4+col*4+2])\n         imp = (input[(h-row)*w*4+(col+1)*4+0] \n                   +input[(h-row)*w*4+(col+1)*4+1] \n                   +input[(h-row)*w*4+(col+1)*4+2])\n        if ((i00 != i0m) || (i00 != i0p) || (i00 != imm) \n           || (i00 != im0) || (i00 != imp)) {\n           output[(h-1-row)*w*4+col*4+0] = 255\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else if (i00 == 0) {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 255\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 255\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n         row = 0\n         i00 = (input[(h-1-row)*w*4+col*4+0] \n                   +input[(h-1-row)*w*4+col*4+1] \n                   +input[(h-1-row)*w*4+col*4+2])\n         i0m = (input[(h-1-row)*w*4+(col-1)*4+0] \n                   +input[(h-1-row)*w*4+(col-1)*4+1] \n                   +input[(h-1-row)*w*4+(col-1)*4+2])\n         i0p = (input[(h-1-row)*w*4+(col+1)*4+0] \n                   +input[(h-1-row)*w*4+(col+1)*4+1] \n                   +input[(h-1-row)*w*4+(col+1)*4+2])\n         ipm = (input[(h-2-row)*w*4+(col-1)*4+0] \n                   +input[(h-2-row)*w*4+(col-1)*4+1] \n                   +input[(h-2-row)*w*4+(col-1)*4+2])\n         ip0 = (input[(h-2-row)*w*4+col*4+0] \n                   +input[(h-2-row)*w*4+col*4+1] \n                   +input[(h-2-row)*w*4+col*4+2])\n         ipp = (input[(h-2-row)*w*4+(col+1)*4+0] \n                   +input[(h-2-row)*w*4+(col+1)*4+1] \n                   +input[(h-2-row)*w*4+(col+1)*4+2])\n        if ((i00 != i0m) || (i00 != i0p) || (i00 != ipm) \n           || (i00 != ip0) || (i00 != ipp)) {\n           output[(h-1-row)*w*4+col*4+0] = 255\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else if (i00 == 0) {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 0\n           output[(h-1-row)*w*4+col*4+2] = 255\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n        else {\n           output[(h-1-row)*w*4+col*4+0] = 0\n           output[(h-1-row)*w*4+col*4+1] = 255\n           output[(h-1-row)*w*4+col*4+2] = 0\n           output[(h-1-row)*w*4+col*4+3] = 255\n           }\n         }\n      //\n      // corners\n      //\n      row = 0\n      col = 0\n      i00 = (input[(h-1-row)*w*4+col*4+0] \n                +input[(h-1-row)*w*4+col*4+1] \n                +input[(h-1-row)*w*4+col*4+2])\n      i0p = (input[(h-1-row)*w*4+(col+1)*4+0] \n                +input[(h-1-row)*w*4+(col+1)*4+1] \n                +input[(h-1-row)*w*4+(col+1)*4+2])\n      ip0 = (input[(h-2-row)*w*4+col*4+0] \n                +input[(h-2-row)*w*4+col*4+1] \n                +input[(h-2-row)*w*4+col*4+2])\n      ipp = (input[(h-2-row)*w*4+(col+1)*4+0] \n                +input[(h-2-row)*w*4+(col+1)*4+1] \n                +input[(h-2-row)*w*4+(col+1)*4+2])\n      if ((i00 != i0p) || (i00 != ip0) || (i00 != ipp)) {\n         output[(h-1-row)*w*4+col*4+0] = 255\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else if (i00 == 0) {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 255\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 255\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      row = 0\n      col = w-1\n      i00 = (input[(h-1-row)*w*4+col*4+0] \n                +input[(h-1-row)*w*4+col*4+1] \n                +input[(h-1-row)*w*4+col*4+2])\n      i0m = (input[(h-1-row)*w*4+(col-1)*4+0] \n                +input[(h-1-row)*w*4+(col-1)*4+1] \n                +input[(h-1-row)*w*4+(col-1)*4+2])\n      ip0 = (input[(h-2-row)*w*4+col*4+0] \n                +input[(h-2-row)*w*4+col*4+1] \n                +input[(h-2-row)*w*4+col*4+2])\n      ipm = (input[(h-2-row)*w*4+(col-1)*4+0] \n                +input[(h-2-row)*w*4+(col-1)*4+1] \n                +input[(h-2-row)*w*4+(col-1)*4+2])\n      if ((i00 != i0m) || (i00 != ip0) || (i00 != ipm)) {\n         output[(h-1-row)*w*4+col*4+0] = 255\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else if (i00 == 0) {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 255\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 255\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      row = h-1\n      col = 0\n      i00 = (input[(h-1-row)*w*4+col*4+0] \n                +input[(h-1-row)*w*4+col*4+1] \n                +input[(h-1-row)*w*4+col*4+2])\n      i0p = (input[(h-1-row)*w*4+(col+1)*4+0] \n                +input[(h-1-row)*w*4+(col+1)*4+1] \n                +input[(h-1-row)*w*4+(col+1)*4+2])\n      im0 = (input[(h-row)*w*4+col*4+0] \n                +input[(h-row)*w*4+col*4+1] \n                +input[(h-row)*w*4+col*4+2])\n      imp = (input[(h-row)*w*4+(col+1)*4+0] \n                +input[(h-row)*w*4+(col+1)*4+1] \n                +input[(h-row)*w*4+(col+1)*4+2])\n      if ((i00 != i0p) || (i00 != im0) || (i00 != imp)) {\n         output[(h-1-row)*w*4+col*4+0] = 255\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else if (i00 == 0) {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 255\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 255\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      row = h-1\n      col = w-1\n      i00 = (input[(h-1-row)*w*4+col*4+0] \n                +input[(h-1-row)*w*4+col*4+1] \n                +input[(h-1-row)*w*4+col*4+2])\n      i0m = (input[(h-1-row)*w*4+(col-1)*4+0] \n                +input[(h-1-row)*w*4+(col-1)*4+1] \n                +input[(h-1-row)*w*4+(col-1)*4+2])\n      im0 = (input[(h-row)*w*4+col*4+0] \n                +input[(h-row)*w*4+col*4+1] \n                +input[(h-row)*w*4+col*4+2])\n      imm = (input[(h-row)*w*4+(col-1)*4+0] \n                +input[(h-row)*w*4+(col-1)*4+1] \n                +input[(h-row)*w*4+(col-1)*4+2])\n      if ((i00 != i0m) || (i00 != im0) || (i00 != imm)) {\n         output[(h-1-row)*w*4+col*4+0] = 255\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else if (i00 == 0) {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 0\n         output[(h-1-row)*w*4+col*4+2] = 255\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      else {\n         output[(h-1-row)*w*4+col*4+0] = 0\n         output[(h-1-row)*w*4+col*4+1] = 255\n         output[(h-1-row)*w*4+col*4+2] = 0\n         output[(h-1-row)*w*4+col*4+3] = 255\n         }\n      self.postMessage({buffer:output.buffer},[output.buffer])\n      })\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"586.8293253549306","left":"3025.976797125244","filename":"undefined","inputs":{},"outputs":{}},"0.8903773266711255":{"definition":"//\n// orient edges\n//    input is green:interior, blue:exterior, red:boundary\n//    output is red 128:north,64:south, green 128:east,64:west, blue 128:start,64:stop\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'orient edges'\n//\n// initialization\n//\nvar init = function() {\n   }\n//\n// inputs\n//\nvar inputs = {\n   image:{type:'RGBA',\n      event:function(evt){\n         mod.input = evt.detail\n         var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.width = mod.input.width\n         ctx.canvas.height = mod.input.height \n         ctx.putImageData(mod.input,0,0)\n         var ctx = mod.display.getContext(\"2d\")\n         ctx.canvas.width = mod.input.width\n         ctx.canvas.height = mod.input.height \n         orient_edges()\n         }}}\n//\n// outputs\n//\nvar outputs = {\n   image:{type:'RGBA',\n      event:function(){\n         var ctx = mod.img.getContext(\"2d\")\n         var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n         mods.output(mod,'image',img)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // off-screen display canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.display = canvas\n   //\n   // view button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         win.document.body.appendChild(document.createTextNode('red:north, dark red:south'))\n         win.document.body.appendChild(document.createElement('br'))\n         win.document.body.appendChild(document.createTextNode('green:east, dark green:west'))\n         win.document.body.appendChild(document.createElement('br'))\n         win.document.body.appendChild(document.createTextNode('blue:start, dark blue:stop'))\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.display,0,0)\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n// orient edges\n//\nfunction orient_edges() {\n   var blob = new Blob(['('+worker.toString()+'())'])\n   var url = window.URL.createObjectURL(blob)\n   var webworker = new Worker(url)\n   webworker.addEventListener('message',function(evt) {\n      window.URL.revokeObjectURL(url)\n      var h = mod.img.height\n      var w = mod.img.width\n      var buf = new Uint8ClampedArray(evt.data.buffer)\n      var imgdata = new ImageData(buf,w,h)\n      var ctx = mod.img.getContext(\"2d\")\n      ctx.putImageData(imgdata,0,0)\n      var disp = new Uint8ClampedArray(evt.data.display)\n      var dispdata = new ImageData(disp,w,h)\n      var ctx = mod.display.getContext(\"2d\")\n      ctx.putImageData(dispdata,0,0)\n      if (w > h) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-h/w)\n         var wd = mod.canvas.width\n         var hd = mod.canvas.width*h/w\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-w/h)\n         var y0 = 0\n         var wd = mod.canvas.height*w/h\n         var hd = mod.canvas.height\n         }\n      var w = mod.canvas.width\n      var h = mod.canvas.height\n      var ctx = mod.canvas.getContext(\"2d\")\n      ctx.clearRect(0,0,w,h)\n      ctx.drawImage(mod.display,x0,y0,wd,hd)\n      webworker.terminate()\n      outputs.image.event()\n      })\n   var ctx = mod.canvas.getContext(\"2d\")\n   ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n   webworker.postMessage({\n      height:mod.input.height,width:mod.input.width,\n      buffer:mod.input.data.buffer},\n      [mod.input.data.buffer])\n   }\nfunction worker() {\n   self.addEventListener('message',function(evt) {\n      var h = evt.data.height\n      var w = evt.data.width\n      var input = new Uint8ClampedArray(evt.data.buffer)\n      var output = new Uint8ClampedArray(h*w*4)\n      var row,col\n      var boundary = 0\n      var interior = 1\n      var exterior = 2\n      var alpha = 3\n      var northsouth = 0\n      var north = 128\n      var south = 64\n      var eastwest = 1\n      var east = 128\n      var west = 64\n      var startstop = 2\n      var start = 128\n      var stop = 64\n      //\n      // orient body states\n      //\n      for (row = 1; row < (h-1); ++row) {\n         for (col = 1; col < (w-1); ++col) {\n            output[(h-1-row)*w*4+col*4+northsouth] = 0\n            output[(h-1-row)*w*4+col*4+eastwest] = 0\n            output[(h-1-row)*w*4+col*4+startstop] = 0\n            output[(h-1-row)*w*4+col*4+alpha] = 255\n            if (input[(h-1-(row))*w*4+(col)*4+boundary] != 0) {\n               if ((input[(h-1-(row+1))*w*4+(col)*4+boundary] != 0)\n                  && ((input[(h-1-(row))*w*4+(col+1)*4+interior] != 0)\n                  || (input[(h-1-(row+1))*w*4+(col+1)*4+interior] != 0)))\n                  output[(h-1-row)*w*4+col*4+northsouth] |= north\n               if ((input[(h-1-(row-1))*w*4+(col)*4+boundary] != 0)\n                  && ((input[(h-1-(row))*w*4+(col-1)*4+interior] != 0)\n                  || (input[(h-1-(row-1))*w*4+(col-1)*4+interior] != 0)))\n                  output[(h-1-row)*w*4+col*4+northsouth] |= south\n               if ((input[(h-1-(row))*w*4+(col+1)*4+boundary] != 0)\n                  && ((input[(h-1-(row-1))*w*4+(col)*4+interior] != 0)\n                  || (input[(h-1-(row-1))*w*4+(col+1)*4+interior] != 0)))\n                  output[(h-1-row)*w*4+col*4+eastwest] |= east\n               if ((input[(h-1-(row))*w*4+(col-1)*4+boundary] != 0)\n                  && ((input[(h-1-(row+1))*w*4+(col)*4+interior] != 0)\n                  || (input[(h-1-(row+1))*w*4+(col-1)*4+interior] != 0)))\n                  output[(h-1-row)*w*4+col*4+eastwest] |= west\n               }\n            }\n         }\n      //\n      // orient edge states\n      //\n      for (col = 1; col < (w-1); ++col) {\n         row = 0\n         output[(h-1-row)*w*4+col*4+northsouth] = 0\n         output[(h-1-row)*w*4+col*4+eastwest] = 0\n         output[(h-1-row)*w*4+col*4+startstop] = 0\n         output[(h-1-row)*w*4+col*4+alpha] = 255\n         if (input[(h-1-(row))*w*4+(col)*4+boundary] != 0) {\n            if ((input[(h-1-(row+1))*w*4+(col)*4+boundary] != 0)\n               && (input[(h-1-(row))*w*4+(col+1)*4+interior] != 0)) {\n               output[(h-1-row)*w*4+col*4+northsouth] |= north\n               output[(h-1-row)*w*4+col*4+startstop] |= start\n               }\n            if (input[(h-1-(row))*w*4+(col-1)*4+interior] != 0)\n               output[(h-1-row)*w*4+col*4+startstop] |= stop\n            }\n         row = h-1\n         output[(h-1-row)*w*4+col*4+northsouth] = 0\n         output[(h-1-row)*w*4+col*4+eastwest] = 0\n         output[(h-1-row)*w*4+col*4+startstop] = 0\n         output[(h-1-row)*w*4+col*4+alpha] = 255\n         if (input[(h-1-(row))*w*4+(col)*4+boundary] != 0) {\n            if (input[(h-1-(row))*w*4+(col+1)*4+interior] != 0)\n               output[(h-1-row)*w*4+col*4+startstop] |= stop\n            if ((input[(h-1-(row-1))*w*4+(col)*4+boundary] != 0)\n               && (input[(h-1-(row))*w*4+(col-1)*4+interior] != 0)) {\n               output[(h-1-row)*w*4+col*4+northsouth] |= south\n               output[(h-1-row)*w*4+col*4+startstop] |= start\n               }\n            }\n         }\n      for (row = 1; row < (h-1); ++row) {\n         col = 0\n         output[(h-1-row)*w*4+col*4+northsouth] = 0\n         output[(h-1-row)*w*4+col*4+eastwest] = 0\n         output[(h-1-row)*w*4+col*4+startstop] = 0\n         output[(h-1-row)*w*4+col*4+alpha] = 255\n         if (input[(h-1-(row))*w*4+(col)*4+boundary] != 0) {\n            if ((input[(h-1-(row))*w*4+(col+1)*4+boundary] != 0)\n               && (input[(h-1-(row-1))*w*4+(col)*4+interior] != 0)) {\n               output[(h-1-row)*w*4+col*4+eastwest] |= east\n               output[(h-1-row)*w*4+col*4+startstop] |= start\n               }\n            if (input[(h-1-(row+1))*w*4+(col)*4+interior] != 0)\n               output[(h-1-row)*w*4+col*4+startstop] |= stop\n            }\n         col = w-1\n         output[(h-1-row)*w*4+col*4+northsouth] = 0\n         output[(h-1-row)*w*4+col*4+eastwest] = 0\n         output[(h-1-row)*w*4+col*4+startstop] = 0\n         output[(h-1-row)*w*4+col*4+alpha] = 255\n         if (input[(h-1-(row))*w*4+(col)*4+boundary] != 0) {\n            if (input[(h-1-(row-1))*w*4+(col)*4+interior] != 0)\n               output[(h-1-row)*w*4+col*4+startstop] |= stop\n            if ((input[(h-1-(row))*w*4+(col-1)*4+boundary] != 0)\n               && (input[(h-1-(row+1))*w*4+(col)*4+interior] != 0)) {\n               output[(h-1-row)*w*4+col*4+eastwest] |= west\n               output[(h-1-row)*w*4+col*4+startstop] |= start\n               }\n            }\n         }\n      //\n      // orient corner states (todo)\n      //\n      row = 0\n      col = 0\n      output[(h-1-row)*w*4+col*4+northsouth] = 0\n      output[(h-1-row)*w*4+col*4+eastwest] = 0\n      output[(h-1-row)*w*4+col*4+startstop] = 0\n      output[(h-1-row)*w*4+col*4+alpha] = 255\n      row = h-1\n      col = 0\n      output[(h-1-row)*w*4+col*4+northsouth] = 0\n      output[(h-1-row)*w*4+col*4+eastwest] = 0\n      output[(h-1-row)*w*4+col*4+startstop] = 0\n      output[(h-1-row)*w*4+col*4+alpha] = 255\n      row = 0\n      col = w-1\n      output[(h-1-row)*w*4+col*4+northsouth] = 0\n      output[(h-1-row)*w*4+col*4+eastwest] = 0\n      output[(h-1-row)*w*4+col*4+startstop] = 0\n      output[(h-1-row)*w*4+col*4+alpha] = 255\n      row = h-1\n      col = w-1\n      output[(h-1-row)*w*4+col*4+northsouth] = 0\n      output[(h-1-row)*w*4+col*4+eastwest] = 0\n      output[(h-1-row)*w*4+col*4+startstop] = 0\n      output[(h-1-row)*w*4+col*4+alpha] = 255\n      //\n      // invert background for display\n      //\n      var display = new Uint8ClampedArray(h*w*4)\n      var r,g,b,i\n      for (row = 0; row < h; ++row) {\n         for (col = 0; col < w; ++col) {\n            r = output[(h-1-row)*w*4+col*4+0]\n            g = output[(h-1-row)*w*4+col*4+1]\n            b = output[(h-1-row)*w*4+col*4+2]\n            i = r+g+b\n            if (i != 0) {            \n               display[(h-1-row)*w*4+col*4+0] = output[(h-1-row)*w*4+col*4+0]\n               display[(h-1-row)*w*4+col*4+1] = output[(h-1-row)*w*4+col*4+1]\n               display[(h-1-row)*w*4+col*4+2] = output[(h-1-row)*w*4+col*4+2]\n               display[(h-1-row)*w*4+col*4+3] = output[(h-1-row)*w*4+col*4+3]\n               }\n            else {\n               display[(h-1-row)*w*4+col*4+0] = 255\n               display[(h-1-row)*w*4+col*4+1] = 255\n               display[(h-1-row)*w*4+col*4+2] = 255\n               display[(h-1-row)*w*4+col*4+3] = 255\n               }\n            }\n         }\n      //\n      // return output\n      //\n      self.postMessage({buffer:output.buffer,display:display.buffer},[output.buffer,display.buffer])\n      })\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"675.9879780055046","left":"3498.51499085382","filename":"undefined","inputs":{},"outputs":{}},"0.3135579179893032":{"definition":"//\n// distance transform \n//    assumes thresholded image, with zero intensity exterior\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2015,6\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'offset'\n//\n// initialization\n//\nvar init = function() {\n   mod.offset.value = '0.7500600000000001'\n   }\n//\n// inputs\n//\nvar inputs = {\n   distances:{type:'F32',\n      event:function(evt){\n         mod.distances = evt.detail\n         var h = mod.distances.height\n         var w = mod.distances.width\n         var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.height = mod.distances.height \n         ctx.canvas.width = mod.distances.width\n         if (mod.offset.value != '')\n            offset()\n         }},\n   offset:{type:'number',\n      event:function(evt){\n         mod.offset.value = evt.detail\n         offset()}}}\n//\n// outputs\n//\nvar outputs = {\n   image:{type:'RGBA',\n      event:function(){\n         var ctx = mod.img.getContext(\"2d\")\n         var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n         mods.output(mod,'image',img)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // offset value\n   //\n   div.appendChild(document.createTextNode('offset (pixels): '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('change',function(){\n         offset()\n         })\n      div.appendChild(input)\n      mod.offset = input\n   //\n   // view button\n   //\n   div.appendChild(document.createElement('br'))\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img,0,0)\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n// offset\n//\nfunction offset() {\n   var blob = new Blob(['('+worker.toString()+'())'])\n   var url = window.URL.createObjectURL(blob)\n   var webworker = new Worker(url)\n   webworker.addEventListener('message',function(evt) {\n      window.URL.revokeObjectURL(url)\n      var h = mod.distances.height\n      var w = mod.distances.width\n      var buf = new Uint8ClampedArray(evt.data.buffer)\n      var imgdata = new ImageData(buf,w,h)\n      var ctx = mod.img.getContext(\"2d\")\n      ctx.putImageData(imgdata,0,0)\n      if (w > h) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-h/w)\n         var wd = mod.canvas.width\n         var hd = mod.canvas.width*h/w\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-w/h)\n         var y0 = 0\n         var wd = mod.canvas.height*w/h\n         var hd = mod.canvas.height\n         }\n      var ctx = mod.canvas.getContext(\"2d\")\n      ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n      ctx.drawImage(mod.img,x0,y0,wd,hd)\n      webworker.terminate()\n      outputs.image.event()\n      })\n   var ctx = mod.canvas.getContext(\"2d\")\n   ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n   var offset = parseFloat(mod.offset.value)\n   webworker.postMessage({\n      height:mod.distances.height,width:mod.distances.width,\n      offset:offset,buffer:mod.distances.buffer})\n   }\n//\n// offset worker\n//\nfunction worker() {\n   self.addEventListener('message',function(evt) {\n      var h = evt.data.height\n      var w = evt.data.width\n      var offset = evt.data.offset\n      var input = new Float32Array(evt.data.buffer)\n      var output = new Uint8ClampedArray(4*h*w)\n      for (var row = 0; row < h; ++row) {\n         for (var col = 0; col < w; ++col) {\n            if (input[(h-1-row)*w+col] <= offset) {\n               output[(h-1-row)*w*4+col*4+0] = 255\n               output[(h-1-row)*w*4+col*4+1] = 255\n               output[(h-1-row)*w*4+col*4+2] = 255\n               output[(h-1-row)*w*4+col*4+3] = 255\n               }\n            else {\n               output[(h-1-row)*w*4+col*4+0] = 0\n               output[(h-1-row)*w*4+col*4+1] = 0\n               output[(h-1-row)*w*4+col*4+2] = 0\n               output[(h-1-row)*w*4+col*4+3] = 255\n               }\n            }\n         }\n      self.postMessage({buffer:output.buffer},[output.buffer])\n      })\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"515.5840218583129","left":"2530.049047610382","filename":"undefined","inputs":{},"outputs":{}},"0.17844113591127098":{"definition":"//\n// cut raster\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'cut raster'\n//\n// initialization\n//\nvar init = function() {\n   mod.in.value = '0.01'\n   mod.mm.value = '0.254'\n   }\n//\n// inputs\n//\nvar inputs = {\n   imageInfo:{type:'object',\n      event:function(evt){\n         mod.name = evt.detail.name\n         mod.dpi = evt.detail.dpi\n         mod.width = evt.detail.width\n         mod.height = evt.detail.height\n         }},\n   path:{type:'array',\n      event:function(evt){\n         if (mod.label.nodeValue == 'calculating') {\n            mod.label.nodeValue = 'calculate'\n            mod.labelspan.style.fontWeight = 'normal'\n            mod.path = evt.detail\n            outputs.toolpath.event()\n            }\n         }}}\n//\n// outputs\n//\nvar outputs = {\n   offset:{type:'number',\n      event:function(){\n         var pixels = 0.5*parseFloat(mod.in.value)*mod.dpi\n         mods.output(mod,'offset',pixels)\n         }},\n   toolpath:{type:'object',\n      event:function(){\n         cmd = {}\n         cmd.path = mod.path\n         cmd.name = mod.name\n         cmd.dpi = mod.dpi\n         cmd.width = mod.width\n         cmd.height = mod.height\n         mods.output(mod,'toolpath',cmd)\n         }}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   div.appendChild(document.createTextNode('tool diameter'))\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('mm: '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('input',function(){\n         mod.in.value = parseFloat(mod.mm.value)/25.4\n         })\n      div.appendChild(input)\n      mod.mm = input\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('in: '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('input',function(){\n         mod.mm.value = parseFloat(mod.in.value)*25.4\n         })\n      div.appendChild(input)\n      mod.in = input\n   div.appendChild(document.createElement('br'))\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      var span = document.createElement('span')\n         var text = document.createTextNode('calculate')\n            mod.label = text\n            span.appendChild(text)\n         mod.labelspan = span\n         btn.appendChild(span)\n      btn.addEventListener('click',function(){\n         mod.label.nodeValue = 'calculating'\n         mod.labelspan.style.fontWeight = 'bold'\n         outputs.offset.event()\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n;\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n\n","top":"800.5458616818088","left":"1400.6739870292254","filename":"undefined","inputs":{},"outputs":{}},"0.6488303557466412":{"definition":"//\n// image threshold\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2015,6\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'image threshold'\n//\n// initialization\n//\nvar init = function() {\n   mod.threshold.value = '0.5'\n   }\n//\n// inputs\n//\nvar inputs = {\n   image:{type:'RGBA',\n      event:function(evt){\n         mod.input = evt.detail\n         var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.width = mod.input.width\n         ctx.canvas.height = mod.input.height \n         ctx.putImageData(mod.input,0,0)\n         threshold_image()}}}\n//\n// outputs\n//\nvar outputs = {\n   image:{type:'RGBA',\n      event:function(){\n         var ctx = mod.img.getContext(\"2d\")\n         var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n         mods.output(mod,'image',img)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // threshold value\n   //\n   div.appendChild(document.createTextNode('threshold (0-1): '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('change',function(){\n         threshold_image()\n         })\n      div.appendChild(input)\n      mod.threshold = input\n   div.appendChild(document.createElement('br'))\n   //\n   // view button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img,0,0)\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n// threshold image\n//\nfunction threshold_image() {\n   var blob = new Blob(['('+worker.toString()+'())'])\n   var url = window.URL.createObjectURL(blob)\n   var webworker = new Worker(url)\n   webworker.addEventListener('message',function(evt) {\n      window.URL.revokeObjectURL(url)\n      var h = mod.img.height\n      var w = mod.img.width\n      var buf = new Uint8ClampedArray(evt.data.buffer)\n      var imgdata = new ImageData(buf,w,h)\n      var ctx = mod.img.getContext(\"2d\")\n      ctx.putImageData(imgdata,0,0)\n      if (w > h) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-h/w)\n         var wd = mod.canvas.width\n         var hd = mod.canvas.width*h/w\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-w/h)\n         var y0 = 0\n         var wd = mod.canvas.height*w/h\n         var hd = mod.canvas.height\n         }\n      var ctx = mod.canvas.getContext(\"2d\")\n      ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n      ctx.drawImage(mod.img,x0,y0,wd,hd)\n      webworker.terminate()\n      outputs.image.event()\n      })\n   var ctx = mod.canvas.getContext(\"2d\")\n   ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n   var t = parseFloat(mod.threshold.value)\n   var ctx = mod.img.getContext(\"2d\")\n   ctx.putImageData(mod.input,0,0)\n   var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n   webworker.postMessage({\n      height:mod.input.height,width:mod.input.width,threshold:t,\n      buffer:img.data.buffer},\n      [img.data.buffer])\n   }\nfunction worker() {\n   self.addEventListener('message',function(evt) {\n      var h = evt.data.height\n      var w = evt.data.width\n      var t = evt.data.threshold\n      var buf = new Uint8ClampedArray(evt.data.buffer)\n      var r,g,b,a,i\n      for (var row = 0; row < h; ++row) {\n         for (var col = 0; col < w; ++col) {\n            r = buf[(h-1-row)*w*4+col*4+0] \n            g = buf[(h-1-row)*w*4+col*4+1] \n            b = buf[(h-1-row)*w*4+col*4+2] \n            a = buf[(h-1-row)*w*4+col*4+3] \n            i = (r+g+b)/(3*255)\n            if (a == 0)\n               val = 255\n            else if (i > t)\n               var val = 255\n            else\n               var val = 0\n            buf[(h-1-row)*w*4+col*4+0] = val\n            buf[(h-1-row)*w*4+col*4+1] = val\n            buf[(h-1-row)*w*4+col*4+2] = val\n            buf[(h-1-row)*w*4+col*4+3] = 255\n            }\n         }\n      self.postMessage({buffer:buf.buffer},[buf.buffer])\n      })\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"363.76195788363077","left":"1468.0034050207446","filename":"undefined","inputs":{},"outputs":{}},"0.749132408760488":{"definition":"//\n// vectorize\n//    input is red 128:north,64:south, green 128:east,64:west, blue 128:start,64:stop\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'vectorize'\n//\n// initialization\n//\nvar init = function() {\n   mod.error.value = '1'\n   }\n//\n// inputs\n//\nvar inputs = {\n   image:{type:'RGBA',\n      event:function(evt){\n         mod.input = evt.detail\n         var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.width = mod.input.width\n         ctx.canvas.height = mod.input.height \n         ctx.putImageData(mod.input,0,0)\n         vectorize()\n         }}}\n//\n// outputs\n//\nvar outputs = {\n   path:{type:'array',\n      event:function(){\n         mods.output(mod,'path',mod.path)\n         }}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen SVG\n   //\n   var svgNS = \"http://www.w3.org/2000/svg\"\n   var svg = document.createElementNS(svgNS,\"svg\")\n   svg.setAttribute('id',mod.div.id+'svg')\n   svg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\",\n      \"xmlns:xlink\",\"http://www.w3.org/1999/xlink\")\n   svg.setAttribute('width',mods.ui.canvas)\n   svg.setAttribute('height',mods.ui.canvas)\n   svg.style.backgroundColor = 'rgb(255,255,255)'\n   var g = document.createElementNS(svgNS,'g')\n   g.setAttribute('id',mod.div.id+'g')\n   svg.appendChild(g)\n   div.appendChild(svg)\n   div.appendChild(document.createElement('br'))   \n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // error value\n   //\n   div.appendChild(document.createTextNode('vector fit (pixels): '))\n   //div.appendChild(document.createElement('br'))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('change',function(){\n         vectorize()\n         })\n      div.appendChild(input)\n      mod.error = input\n   div.appendChild(document.createElement('br'))\n   //\n   // sort\n   //\n   div.appendChild(document.createTextNode('sort distance: '))\n   var input = document.createElement('input')\n      input.type = 'checkbox'\n      input.id = mod.div.id+'sort'\n      input.checked = true\n      div.appendChild(input)\n      mod.sort = input\n   div.appendChild(document.createElement('br'))\n   //\n   // view button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         var svg = document.getElementById(mod.div.id+'svg')\n         var clone = svg.cloneNode(true)\n         clone.setAttribute('width',mod.img.width)\n         clone.setAttribute('height',mod.img.height)\n         win.document.body.appendChild(clone)\n         })\n      div.appendChild(btn)\n   }\n//\n// local functions\n//\n// vectorize\n//\nfunction vectorize() {\n   //\n   // draw path\n   //\n   function draw_path(path) {\n      window.URL.revokeObjectURL(url)\n      var svg = document.getElementById(mod.div.id+'svg')\n      svg.setAttribute('viewBox',\"0 0 \"+(mod.img.width-1)+\" \"+(mod.img.height-1))\n      var g = document.getElementById(mod.div.id+'g')\n      svg.removeChild(g)\n      var g = document.createElementNS('http://www.w3.org/2000/svg','g')\n      g.setAttribute('id',mod.div.id+'g')\n      var h = mod.img.height\n      var w = mod.img.width\n      var xend = null\n      var yend = null\n      //\n      // loop over segments\n      //\n      for (var segment in path) {\n         if (path[segment].length > 1) {\n            if (xend != null) {\n               //\n               // draw connection from previous segment\n               //\n               var line = document.createElementNS('http://www.w3.org/2000/svg','line')\n               line.setAttribute('stroke','red')\n               line.setAttribute('stroke-width',1)\n               line.setAttribute('stroke-linecap','round')\n               var x1 = xend\n               var y1 = yend\n               var x2 = path[segment][0][0]\n               var y2 = h-path[segment][0][1]-1\n               line.setAttribute('x1',x1)\n               line.setAttribute('y1',y1)\n               line.setAttribute('x2',x2)\n               line.setAttribute('y2',y2)\n               var dx = x2-x1\n               var dy = y2-y1\n               var d = Math.sqrt(dx*dx+dy*dy)\n               if (d > 0) {\n                  nx = 6*dx/d\n                  ny = 6*dy/d\n                  var tx = 3*dy/d\n                  var ty = -3*dx/d\n                  g.appendChild(line)\n                  triangle = document.createElementNS('http://www.w3.org/2000/svg','polygon')\n                  triangle.setAttribute('points',x2+','+y2+' '+(x2-nx+tx)+','+(y2-ny+ty)\n                     +' '+(x2-nx-tx)+','+(y2-ny-ty))\n                  triangle.setAttribute('fill','red')\n                  g.appendChild(triangle)\n                  }\n               }\n            //\n            // loop over points\n            //\n            for (var point = 1; point < path[segment].length; ++point) {\n               var line = document.createElementNS('http://www.w3.org/2000/svg','line')\n               line.setAttribute('stroke','black')\n               line.setAttribute('stroke-width',1)\n               line.setAttribute('stroke-linecap','round')\n               var x1 = path[segment][point-1][0]\n               var y1 = h-path[segment][point-1][1]-1\n               var x2 = path[segment][point][0]\n               var y2 = h-path[segment][point][1]-1\n               xend = x2\n               yend = y2\n               line.setAttribute('x1',x1)\n               line.setAttribute('y1',y1)\n               line.setAttribute('x2',x2)\n               line.setAttribute('y2',y2)\n               var dx = x2-x1\n               var dy = y2-y1\n               var d = Math.sqrt(dx*dx+dy*dy)\n               if (d > 0) {\n                  nx = 6*dx/d\n                  ny = 6*dy/d\n                  var tx = 3*dy/d\n                  var ty = -3*dx/d\n                  g.appendChild(line)\n                  triangle = document.createElementNS('http://www.w3.org/2000/svg','polygon')\n                  triangle.setAttribute('points',x2+','+y2+' '+(x2-nx+tx)+','+(y2-ny+ty)\n                     +' '+(x2-nx-tx)+','+(y2-ny-ty))\n                  triangle.setAttribute('fill','black')\n                  g.appendChild(triangle)\n                  }\n               }\n            }\n         }\n      svg.appendChild(g)\n      }\n   //\n   // set up worker\n   //\n   var blob = new Blob(['('+worker.toString()+'())'])\n   var url = window.URL.createObjectURL(blob)\n   var webworker = new Worker(url)\n   webworker.addEventListener('message',function(evt) {\n      window.URL.revokeObjectURL(url)\n      webworker.terminate()\n      mod.path = evt.data.path\n      draw_path(mod.path)\n      outputs.path.event()\n      })\n   //\n   // call worker\n   //\n   webworker.postMessage({\n      height:mod.input.height,width:mod.input.width,sort:mod.sort.checked,\n      error:parseFloat(mod.error.value),\n      buffer:mod.input.data.buffer})\n   }\n//\n// vectorize worker\n//\nfunction worker() {\n   self.addEventListener('message',function(evt) {\n      var h = evt.data.height\n      var w = evt.data.width\n      var sort = evt.data.sort\n      var input = new Uint8ClampedArray(evt.data.buffer)\n      var northsouth = 0\n      var north = 128\n      var south = 64\n      var eastwest = 1\n      var east = 128\n      var west = 64\n      var startstop = 2\n      var start = 128\n      var stop = 64\n      var path = []\n      //\n      // edge follower\n      //\n      function follow_edges(row,col) {\n         if ((input[(h-1-row)*w*4+col*4+northsouth] != 0)\n            || (input[(h-1-row)*w*4+col*4+eastwest] != 0)) {\n            path[path.length] = [[col,row]]\n            while (1) {\n               if (input[(h-1-row)*w*4+col*4+northsouth] & north) {\n                  input[(h-1-row)*w*4+col*4+northsouth] =\n                     input[(h-1-row)*w*4+col*4+northsouth] & ~north\n                  row += 1\n                  path[path.length-1][path[path.length-1].length] = [col,row]\n                  }\n               else if (input[(h-1-row)*w*4+col*4+northsouth] & south) {\n                  input[(h-1-row)*w*4+col*4+northsouth] =\n                     input[(h-1-row)*w*4+col*4+northsouth] & ~south\n                  row -= 1\n                  path[path.length-1][path[path.length-1].length] = [col,row]\n                  }\n               else if (input[(h-1-row)*w*4+col*4+eastwest] & east) {\n                  input[(h-1-row)*w*4+col*4+eastwest] =\n                     input[(h-1-row)*w*4+col*4+eastwest] & ~east\n                  col += 1\n                  path[path.length-1][path[path.length-1].length] = [col,row]\n                  }\n               else if (input[(h-1-row)*w*4+col*4+eastwest] & west) {\n                  input[(h-1-row)*w*4+col*4+eastwest] =\n                     input[(h-1-row)*w*4+col*4+eastwest] & ~west\n                  col -= 1\n                  path[path.length-1][path[path.length-1].length] = [col,row]\n                  }\n               else\n                  break\n               }\n            }\n         }\n      //\n      // follow boundary starts\n      //\n      for (var row = 1; row < (h-1); ++row) {\n         col = 0\n         follow_edges(row,col)\n         col = w-1\n         follow_edges(row,col)\n         }\n      for (var col = 1; col < (w-1); ++col) {\n         row = 0\n         follow_edges(row,col)\n         row = h-1      \n         follow_edges(row,col)\n         }\n      //\n      // follow interior paths\n      //\n      for (var row = 1; row < (h-1); ++row) {\n         for (var col = 1; col < (w-1); ++col) {\n            follow_edges(row,col)\n            }\n         }\n      //\n      // vectorize path\n      //\n      var error = evt.data.error\n      var vecpath = []\n      for (var seg = 0; seg < path.length; ++seg) {\n         var x0 = path[seg][0][0]\n         var y0 = path[seg][0][1]\n         vecpath[vecpath.length] = [[x0,y0]]\n         var xsum = x0\n         var ysum = y0\n         var sum = 1\n         for (var pt = 1; pt < path[seg].length; ++pt) {\n            var xold = x\n            var yold = y\n            var x = path[seg][pt][0]\n            var y = path[seg][pt][1]\n            if (sum == 1) {\n               xsum += x\n               ysum += y\n               sum += 1\n               }\n            else {\n               var xmean = xsum/sum\n               var ymean = ysum/sum\n               var dx = xmean-x0\n               var dy = ymean-y0\n               var d = Math.sqrt(dx*dx+dy*dy)\n               var nx = dy/d\n               var ny = -dx/d\n               var l = Math.abs(nx*(x-x0)+ny*(y-y0))\n               if (l < error) {\n                  xsum += x\n                  ysum += y\n                  sum += 1\n                  }\n               else {\n                  vecpath[vecpath.length-1][vecpath[vecpath.length-1].length] = [xold,yold]\n                  x0 = xold\n                  y0 = yold\n                  xsum = xold\n                  ysum = yold\n                  sum = 1\n                  }\n               }\n            if (pt == (path[seg].length-1)) {\n               vecpath[vecpath.length-1][vecpath[vecpath.length-1].length] = [x,y]\n               }\n            }\n         }\n      //\n      // sort path\n      //\n      if ((vecpath.length > 0) && (sort == true)) {\n         var dmin = w*w+h*h\n         segmin = null\n         for (var seg = 0; seg < vecpath.length; ++seg) {\n            var x = vecpath[seg][0][0]\n            var y = vecpath[seg][0][0]\n            var d = x*x+y*y\n            if (d < dmin) {\n               dmin = d\n               segmin = seg\n               }\n            }\n         if (segmin != null) {\n            var sortpath = [vecpath[segmin]]\n            vecpath.splice(segmin,1)\n            }\n         while (vecpath.length > 0) {\n            var dmin = w*w+h*h\n            var x0 = sortpath[sortpath.length-1][sortpath[sortpath.length-1].length-1][0]\n            var y0 = sortpath[sortpath.length-1][sortpath[sortpath.length-1].length-1][1]\n            segmin = null\n            for (var seg = 0; seg < vecpath.length; ++seg) {\n               var x = vecpath[seg][0][0]\n               var y = vecpath[seg][0][1]\n               var d = (x-x0)*(x-x0)+(y-y0)*(y-y0)\n               if (d < dmin) {\n                  dmin = d\n                  segmin = seg\n                  }\n               }\n            if (segmin != null) {\n               sortpath[sortpath.length] = vecpath[segmin]\n               vecpath.splice(segmin,1)\n               }\n            }\n         }\n      else if ((vecpath.length > 0) && (sort == false))\n         sortpath = vecpath\n      else\n         sortpath = []\n      //\n      // return path\n      //\n      self.postMessage({path:sortpath})\n      })\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"760.3340840284646","left":"3984.656552955962","filename":"undefined","inputs":{},"outputs":{}},"0.0006820493131942662":{"definition":"//\n// read SVG\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'read SVG'\n//\n// initialization\n//\nvar init = function() {\n   }\n//\n// inputs\n//\nvar inputs = {\n   SVG:{type:'string',\n      event:function(evt) {\n         svg_load_handler({target:{result:evt.detail}})\n         }}}\n//\n// outputs\n//\nvar outputs = {\n   SVG:{type:'string',\n      event:function(){\n         mods.output(mod,'SVG',mod.str)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // file input control\n   //\n   var file = document.createElement('input')\n      file.setAttribute('type','file')\n      file.setAttribute('id',div.id+'file_input')\n      file.style.position = 'absolute'\n      file.style.left = 0\n      file.style.top = 0\n      file.style.width = 0\n      file.style.height = 0\n      file.style.opacity = 0\n      file.addEventListener('change',function() {\n         svg_read_handler()\n         })\n      div.appendChild(file)\n      mod.file = file\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // file select button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('select SVG file'))\n      btn.addEventListener('click',function(){\n         var file = document.getElementById(div.id+'file_input')\n         file.value = null\n         file.click()\n         })\n      div.appendChild(btn)\n   div.appendChild(document.createElement('br'))\n   //\n   // view button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img,0,0)\n         })\n      div.appendChild(btn)\n   div.appendChild(document.createElement('br'))\n   //\n   // info div\n   //\n   var info = document.createElement('div')\n      info.setAttribute('id',div.id+'info')\n      var text = document.createTextNode('file:')\n         info.appendChild(text)\n         mod.name = text\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('width:')\n         info.appendChild(text)\n         mod.width = text\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('height:')\n         info.appendChild(text)\n         mod.height = text\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('units per inch:')\n         info.appendChild(text)\n         mod.units = text\n      div.appendChild(info)\n   }\n//\n// local functions\n//\n// read handler\n//\nfunction svg_read_handler(event) {\n   //\n   // read as text\n   //\n   var file_reader = new FileReader()\n   file_reader.onload = svg_load_handler\n   var input_file = mod.file.files[0]\n   var file_name = input_file.name\n   mod.name.nodeValue = \"file: \"+file_name\n   file_reader.readAsText(input_file)\n   }\n//\n// load handler\n//\nfunction svg_load_handler(event) {\n   mod.str = event.target.result\n   //\n   // parse size\n   //\n   var i = mod.str.indexOf(\"width\")\n   if (i == -1) {\n      mod.width.nodeValue = \"width: not found\"\n      mod.height.nodeValue = \"height: not found\"\n      }\n   else {\n      var i1 = mod.str.indexOf(\"\\\"\",i+1)\n      var i2 = mod.str.indexOf(\"\\\"\",i1+1)\n      var width = mod.str.substring(i1+1,i2)\n      i = mod.str.indexOf(\"height\")\n      i1 = mod.str.indexOf(\"\\\"\",i+1)\n      i2 = mod.str.indexOf(\"\\\"\",i1+1)\n      var height = mod.str.substring(i1+1,i2)\n      ih = mod.str.indexOf(\"height\")\n      if (width.indexOf(\"px\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 90\n         }\n      else if (width.indexOf(\"mm\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 25.4\n         }\n      else if (width.indexOf(\"cm\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 2.54\n         }\n      else if (width.indexOf(\"in\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 1\n         }\n      else {\n         var units = 90\n         }\n      mod.width.nodeValue = \"width: \"+width\n      mod.height.nodeValue = \"height: \"+height\n      mod.units.nodeValue = \"units per inch: \"+units\n      }\n   //\n   // display\n   //\n   var img = new Image()\n   var src = \"data:image/svg+xml;base64,\"+window.btoa(mod.str)\n   img.setAttribute(\"src\",src)\n   img.onload = function() {\n      if (img.width > img.height) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-img.height/img.width)\n         var w = mod.canvas.width\n         var h = mod.canvas.width*img.height/img.width\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-img.width/img.height)\n         var y0 = 0\n         var w = mod.canvas.height*img.width/img.height\n         var h = mod.canvas.height\n         }\n      var ctx = mod.canvas.getContext(\"2d\")\n         ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n         ctx.drawImage(img,x0,y0,w,h)\n      var ctx = mod.img.getContext(\"2d\")\n         ctx.canvas.width = img.width\n         ctx.canvas.height = img.height \n         ctx.drawImage(img,0,0)\n      outputs.SVG.event()\n      }\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"236.31354001018622","left":"319.78675081474194","filename":"undefined","inputs":{},"outputs":{}},"0.07794749880174023":{"definition":"//\n// convert SVG image\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'convert SVG image'\n//\n// initialization\n//\nvar init = function() {\n   mod.dpi.value = '100'\n   }\n//\n// inputs\n//\nvar inputs = {\n   SVG:{type:'string',\n      event:function(evt){\n         mod.svg = evt.detail\n         get_size()\n         draw_image()}}}\n//\n// outputs\n//\nvar outputs = {\n   image:{type:'RGBA',\n      event:function(){\n         var ctx = mod.img.getContext(\"2d\")\n         var img = ctx.getImageData(0,0,mod.img.width,mod.img.height)\n         mods.output(mod,'image',img)}},\n   imageInfo:{type:'object',\n      event:function(){\n         var obj = {}\n         obj.name = \"SVG image\"\n         obj.dpi = parseFloat(mod.dpi.value)\n         obj.width = mod.img.width\n         obj.height = mod.img.height\n         mods.output(mod,'imageInfo',obj)}}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // view button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('view'))\n      btn.addEventListener('click',function(){\n         var win = window.open('')\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               })\n            win.document.body.appendChild(btn)\n         win.document.body.appendChild(document.createElement('br'))\n         var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n         var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img,0,0)\n         })\n      div.appendChild(btn)\n   //\n   // dpi\n   //\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('dpi: '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('change',function(){\n         draw_image()\n         })\n      div.appendChild(input)\n      mod.dpi = input\n   div.appendChild(document.createTextNode(' (enter)'))\n   //\n   // units\n   //\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('units: '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('change',function(){\n         draw_image()\n         })\n      div.appendChild(input)\n      mod.unitstext = input\n   div.appendChild(document.createTextNode(' (enter)'))\n   //\n   // size\n   //\n   div.appendChild(document.createElement('br'))\n   var text = document.createTextNode('image size:')\n      div.appendChild(text)\n   div.appendChild(document.createElement('br'))\n   var text = document.createTextNode('(pixels)')\n      div.appendChild(text)\n      mod.pixels = text\n   div.appendChild(document.createElement('br'))\n   var text = document.createTextNode('(inches)')\n      div.appendChild(text)\n      mod.inches = text\n   div.appendChild(document.createElement('br'))\n   var text = document.createTextNode('(mm)')\n      div.appendChild(text)\n      mod.mm = text\n   }\n//\n// local functions\n//\n// get size\n//\nfunction get_size() {\n   var i = mod.svg.indexOf(\"width\")\n   if (i == -1) {\n      var width = 1\n      var height = 1\n      var units = 90\n      }\n   else {\n      var i1 = mod.svg.indexOf(\"\\\"\",i+1)\n      var i2 = mod.svg.indexOf(\"\\\"\",i1+1)\n      var width = mod.svg.substring(i1+1,i2)\n      i = mod.svg.indexOf(\"height\")\n      i1 = mod.svg.indexOf(\"\\\"\",i+1)\n      i2 = mod.svg.indexOf(\"\\\"\",i1+1)\n      var height = mod.svg.substring(i1+1,i2)\n      ih = mod.svg.indexOf(\"height\")\n      if (width.indexOf(\"px\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 90\n         }\n      else if (width.indexOf(\"mm\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 25.4\n         }\n      else if (width.indexOf(\"cm\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 2.54\n         }\n      else if (width.indexOf(\"in\") != -1) {\n         width = width.slice(0,-2)\n         height = height.slice(0,-2)\n         var units = 1\n         }\n      else {\n         var units = 90\n         }\n      }\n   mod.width = parseFloat(width)\n   mod.height = parseFloat(height)\n   mod.units = units\n   mod.unitstext.value = units\n   }\n//\n// draw image\n//\nfunction draw_image() {\n   var dpi = parseFloat(mod.dpi.value)\n   var units = parseFloat(mod.unitstext.value)\n   var width = parseInt(dpi*mod.width/units)\n   var height = parseInt(dpi*mod.height/units)\n   mod.pixels.nodeValue = width+' x '+height+\" (pixels)\"\n   mod.inches.nodeValue = (width/dpi).toFixed(3)+' x '+(height/dpi).toFixed(3)+\" (inches)\"\n   mod.mm.nodeValue = (25.4*width/dpi).toFixed(3)+' x '+(25.4*height/dpi).toFixed(3)+\" (mm)\"\n   var src = \"data:image/svg+xml;base64,\"+window.btoa(mod.svg)\n   var img = new Image()\n   img.setAttribute(\"src\",src)\n   img.onload = function() {\n      if (width > height) {\n         var x0 = 0\n         var y0 = mod.canvas.height*.5*(1-height/width)\n         var w = mod.canvas.width\n         var h = mod.canvas.width*height/width\n         }\n      else {\n         var x0 = mod.canvas.width*.5*(1-width/height)\n         var y0 = 0\n         var w = mod.canvas.height*width/height\n         var h = mod.canvas.height\n         }\n      mod.img.width = width\n      mod.img.height = height\n      var ctx = mod.img.getContext(\"2d\")\n         ctx.clearRect(0,0,width,height)\n         ctx.drawImage(img,0,0,width,height)\n      var ctx = mod.canvas.getContext(\"2d\")\n         ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n         ctx.drawImage(mod.img,x0,y0,w,h)\n      outputs.image.event()\n      outputs.imageInfo.event()\n      }\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"287.4266824114411","left":"867.96873654215","filename":"undefined","inputs":{},"outputs":{}},"0.5103663999622159":{"definition":"//\n// note\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2017\n// Modified by Francisco Sanchez 2019\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'note'\n//\n// initialization\n//\nvar init = function() {\n   mod.text.value = 'Step 2: Adjust and assign preset settings'\n   }\n//\n// inputs\n//\nvar inputs = {}\n//\n// outputs\n//\nvar outputs = {}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // text\n   //\n   var text = document.createElement('textarea')\n      text.style.backgroundColor='#D4E157';\n      text.setAttribute('rows',mods.ui.rows)\n      text.setAttribute('cols',mods.ui.cols)\n      div.appendChild(text)\n      mod.text = text\n   div.appendChild(document.createElement('br'))\n}\n//\n// local functions\n//\n;\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"1232.022243132555","left":"1621.9625210923598","filename":"undefined","inputs":{},"outputs":{}},"0.006161897402890748":{"definition":"\n//\n// Trotec laser cutter\n//\n// Neil Gershenfeld 1/18/20\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'Trotec laser cutter'\n//\n// initialization\n//\nvar init = function() {\n   mod.power.value = '5'\n   mod.velocity.value = '10'\n   mod.frequency.value = '5000'\n   mod.xpos.value = '50'\n   mod.ypos.value = '50'\n   mod.topleft.checked = true\n   }\n//\n// inputs\n//\nvar inputs = {\n   path:{type:'',\n      event:function(evt){\n         mod.name = evt.detail.name\n         mod.path = evt.detail.path\n         mod.dpi = evt.detail.dpi\n         mod.width = evt.detail.width\n         mod.height = evt.detail.height\n         make_path()\n         }},\n   settings:{type:'',\n      event:function(evt){\n         set_values(evt.detail)\n         }}}\n//\n// outputs\n//\nvar outputs = {\n   file:{type:'',\n      event:function(str){\n         obj = {}\n         obj.type = 'file'\n         obj.name = mod.name+'.tro'\n         obj.contents = str\n         mods.output(mod,'file',obj)\n         }}}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   div.appendChild(document.createTextNode('model:'))\n      div.appendChild(document.createElement('br'))\n      var select = document.createElement('select')\n      select.setAttribute('style', 'width:150px');\n      var el = document.createElement('option')\n          el.textContent = 'Speedy 100'\n          el.value = 'Speedy 100'\n          select.appendChild(el)\n      var el = document.createElement('option')\n          el.textContent = 'Speedy 100 Flexx CO2'\n          el.value = 'Speedy 100 Flexx CO2'\n          select.appendChild(el)\n      var el = document.createElement('option')\n          el.textContent = 'Speedy 100 Flexx fiber'\n          el.value = 'Speedy 100 Flexx fiber'\n          select.appendChild(el)\n      var el = document.createElement('option')\n          el.textContent = 'Speedy 400'\n          el.value = 'Speedy 400'\n          select.appendChild(el)\n      div.appendChild(select)\n      mod.model = select \n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('power (%): '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      div.appendChild(input)\n      mod.power = input\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('velocity (mm/s): '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      div.appendChild(input)\n      mod.velocity = input\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('frequency (Hz): '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      div.appendChild(input)\n      mod.frequency = input\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('origin (mm):'))\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('x: '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      div.appendChild(input)\n      mod.xpos = input\n   div.appendChild(document.createTextNode(' y: '))\n   var input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      div.appendChild(input)\n      mod.ypos = input\n   div.appendChild(document.createElement('br'))\n   div.appendChild(document.createTextNode('alignment:'))\n   div.appendChild(document.createElement('br'))\n   var input = document.createElement('input')\n      input.type = 'radio'\n      input.name = mod.div.id+'origin'\n      input.id = mod.div.id+'topleft'\n      div.appendChild(input)\n      mod.topleft = input\n   div.appendChild(document.createTextNode(' left \\u00A0\\u00A0 top \\u00A0\\u00A0 right '))\n   var input = document.createElement('input')\n      input.type = 'radio'\n      input.name = mod.div.id+'origin'\n      input.id = mod.div.id+'topright'\n      div.appendChild(input)\n      mod.topright = input\n   div.appendChild(document.createElement('br'))\n   var input = document.createElement('input')\n      input.type = 'radio'\n      input.name = mod.div.id+'origin'\n      input.id = mod.div.id+'botleft'\n      div.appendChild(input)\n      mod.botleft = input\n   div.appendChild(document.createTextNode(' left bottom right '))\n   var input = document.createElement('input')\n      input.type = 'radio'\n      input.name = mod.div.id+'origin'\n      input.id = mod.div.id+'botright'\n      div.appendChild(input)\n      mod.botright = input\n   }\n//\n// local functions\n//\n// set_values\n//\nfunction set_values(settings) {\n   for (var s in settings) {\n      switch(s) {\n         case 'power (%)':\n            mod.power.value = settings[s]\n            break\n         case 'velocity (mm/s)':\n            mod.velocity.value = settings[s]\n            break\n         case 'frequency (Hz)':\n            mod.frequency.value = settings[s]\n            break\n         }\n      }\n   }\n//\n// make_path\n//\nfunction make_path() {\n      var model = mod.model.value\n      if (model == \"Speedy 100\") {\n         var um_per_inc = 5\n         var str = \"SL0\\n\" // CO2\n         }\n      else if (model == \"Speedy 100 Flexx CO2\") {\n         var um_per_inc = 5\n         var str = \"SL0\\n\" // CO2\n         }\n      else if (model == \"Speedy 100 Flexx fiber\") {\n         var um_per_inc = 5\n         var str = \"SL4\\n\" // fiber pulse\n         }\n      else if (model == \"Speedy 400\") {\n         var um_per_inc = 5.097\n         var str = \"SL0\\n\" // CO2\n         }\n      var dx = 25.4*mod.width/mod.dpi\n      var dy = 25.4*mod.height/mod.dpi\n      var nx = mod.width\n      var ny = mod.height\n      var power = 100*parseFloat(mod.power.value)\n      var frequency = parseFloat(mod.frequency.value)\n      var scale = 1000*(dx/(nx-1))/um_per_inc\n      var velocity = parseFloat(mod.velocity.value)*1000/um_per_inc\n      var ox = parseFloat(mod.xpos.value)\n      var oy = parseFloat(mod.ypos.value)\n      var xorg = 2600 // Speedy\n      var yorg = 800 // \"\n      if (mod.botleft.checked) {\n         var xoffset = xorg+1000*ox/ um_per_inc\n         var yoffset = yorg+1000*(oy-dy)/um_per_unc\n         }\n      else if (mod.botright.checked) {\n         var xoffset = xorg+1000*(ox-dx)/um_per_inc\n         var yoffset = yorg+1000*(oy-dy)/um_per_inc\n         }\n      else if (mod.topleft.checked) {\n         var xoffset = xorg+1000*ox/um_per_inc\n         var yoffset = yorg+1000*oy/um_per_inc\n         }\n      else if (mod.topright.checked) {\n         var xoffset = xorg+1000*(ox-dx)/um_per_inc\n         var yoffset = yorg+1000*oy/um_per_inc\n         }\n      str += \"ED3\\n\" // exhaust on\n      str += \"ED4\\n\" // air assist on\n      str += \"VS\" + velocity.toFixed(0) + \"\\n\" // set velocity\n      str += \"LF\" + frequency.toFixed(0) + \"\\n\" // set frequency\n      str += \"LP\" + power.toFixed(0) + \"\\n\" // set power\n      str += \"EC\\n\" // execute\n      //\n      // loop over segments\n      //\n      for (var seg = 0; seg < mod.path.length; ++seg) {\n         //\n         // loop over points\n         //\n         x = xoffset + scale * mod.path[seg][0][0]\n         y = yoffset + scale * (ny - mod.path[seg][0][1])\n         if (x < 0) x = 0\n         if (y < 0) y = 0\n         str += \"PA\" + x.toFixed(0) + \",\" + y.toFixed(0) + \"\\n\" // move to start point\n         str += \"PD\\n\" // laser on\n         for (var pt = 1; pt < mod.path[seg].length; ++pt) {\n            x = xoffset + scale * mod.path[seg][pt][0]\n            y = yoffset + scale * (ny - mod.path[seg][pt][1])\n            if (x < 0) x = 0\n            if (y < 0) y = 0\n            str += \"PA\" + x.toFixed(0) + \",\" + y.toFixed(0) + \"\\n\" // move to next point\n            }\n         str += \"PU\\n\" // laser off\n         str += \"EC\\n\" // execute\n         }\n      str += \"EO3\\n\" // exhaust off\n      str += \"EO4\\n\" // air assist off\n      str += \"PA0,0\\n\" // move home   \n      str += \"EC\\n\" // execute\n      outputs.file.event(str)\n      }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"1034.6339132484152","left":"2212.4640706343644","filename":"undefined","inputs":{},"outputs":{}},"0.45864332974522226":{"definition":"//\n// set object\n//\n// Neil Gershenfeld\n// (c) Massachusetts Institute of Technology 2018\n//\n// This work may be reproduced, modified, distributed, performed, and\n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is\n// provided as is; no warranty is provided, and users accept all\n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'set Trotec defaults'\n//\n// initialization\n//\nvar init = function() {\n   //\n   add_output('cut cardboard (3/16)')\n   add_variable('power (%)','var00')\n   mod.var00.value = '75'\n   add_variable('speed (%)','var01')\n   mod.var01.value = '90'\n   add_variable('rate (pps)','var02')\n   mod.var02.value = '100'\n   //\n   add_output('cut acrylic (1/8)')\n   add_variable('power (%)','var10')\n   mod.var10.value = '90'\n   add_variable('speed (%)','var11')\n   mod.var11.value = '25'\n   add_variable('rate (pps)','var12')\n   mod.var12.value = '100'\n   //\n   }\n//\n// inputs\n//\nvar inputs = {}\n//\n// outputs\n//\nvar outputs = {\n   settings:{type:'',\n      event:function(vars){\n         mods.output(mod,'settings',vars)\n         }\n      }\n   }\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   }\n//\n// local functions\n//\nfunction add_output(label) {\n   if (mod.settings == undefined) {\n      mod.settings = {}\n      }\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      var span = document.createElement('span')\n      var text = document.createTextNode(label)\n         span.appendChild(text)\n      btn.appendChild(span)\n      var f = function(label) {\n         btn.addEventListener('click',function() {\n            for (var s in mod.settings)\n               mod.settings[s].span.style.fontWeight = 'normal'\n            mod.settings[label].span.style.fontWeight = 'bold'\n            var vars = {}\n            for (var v in mod.settings[label].variables)\n               vars[v] = mod.settings[label].variables[v].value\n            outputs.settings.event(vars)\n            })\n         }(label)\n      mod.settings[label] = {span:span,variables:{}}\n      mod.div.appendChild(btn)\n      mod.setting = label\n   mod.div.appendChild(document.createElement('br'))\n   }\nfunction add_variable(label,variable) {\n   var text = document.createTextNode(label)\n      mod.div.appendChild(text)\n   mod.div.appendChild(document.createTextNode(': '))\n   input = document.createElement('input')\n      input.type = 'text'\n      input.size = 10\n      mod[variable] = input\n      mod.div.appendChild(input)\n   mod.settings[mod.setting].variables[label] = input \n   mod.div.appendChild(document.createElement('br'))\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"1163.7699179168203","left":"1762.355416958497","filename":"undefined","inputs":{},"outputs":{}},"0.5995732491083103":{"definition":"//\n// note\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2017\n// Modified by Francisco Sanchez 2019\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'note'\n//\n// initialization\n//\nvar init = function() {\n   mod.text.value = 'Step 3: Set your origin'\n   }\n//\n// inputs\n//\nvar inputs = {}\n//\n// outputs\n//\nvar outputs = {}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // text\n   //\n   var text = document.createElement('textarea')\n      text.style.backgroundColor='#D4E157';\n      text.setAttribute('rows',1)\n      text.setAttribute('cols',30)\n      //\n      // watch textarea for resize\n      //\n      new MutationObserver(update_module).observe(text, {\n      attributes: true, attributeFilter: [ \"style\" ]\n      })\n      div.appendChild(text)\n      mod.text = text\n   div.appendChild(document.createElement('br'))\n}\n//\n// local functions\n//\n//\n// update module\n//\nfunction update_module() {\n   mods.fit(mod.div)\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"1339.0118777845285","left":"2268.610700877614","filename":"undefined","inputs":{},"outputs":{}},"0.5810609162900546":{"definition":"//\n// label\n//\n// Neil Gershenfeld\n// (c) Massachusetts Institute of Technology 2018\n// Modified by Francisco Sanchez Arroyo 02-Feb-2020\n//\n// This work may be reproduced, modified, distributed, performed, and\n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is\n// provided as is; no warranty is provided, and users accept all\n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'label'\n//\n// initialization\n//\nvar init = function() {\n   mod.size.value = '400'\n   mod.text.value = 'Trotec laser cut'\n   update_text()\n   }\n//\n// inputs\n//\nvar inputs = {\n}\n//\n// outputs\n//\nvar outputs = {\n}\n//\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //div.appendChild(document.createTextNode('font size: '))\n   input = document.createElement('input')\n      input.type = 'text'\n      input.size = 3\n      input.addEventListener('input',function(evt){\n         update_text()\n         })\n      //div.appendChild(input)\n      mod.size = input\n   //div.appendChild(document.createTextNode(' (%)'))\n   //div.appendChild(document.createElement('br'))\n   //div.appendChild(document.createTextNode('text: '))\n   input = document.createElement('input')\n      input.type = 'text'\n      input.size = 6\n      input.addEventListener('input',function(evt){\n         update_text()\n         })\n      //div.appendChild(input)\n      mod.text = input\n   //div.appendChild(document.createElement('br'))\n   var span = document.createElement('span')\n      var text = document.createTextNode('')\n         span.appendChild(text)\n         mod.label = text\n      div.appendChild(span)\n      mod.span = span\n   }\n//\n// local functions\n//\nfunction update_text() {\n   mod.label.nodeValue = mod.text.value\n   mod.span.style.fontSize = mod.size.value+'%'\n   mods.fit(mod.div)\n   }\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"42.0060356437514","left":"315.72949903545054","filename":"undefined","inputs":{},"outputs":{}},"0.30956860567685873":{"definition":"//\n// note\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2017\n// Modified by Francisco Sanchez 2019\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'note'\n//\n// initialization\n//\nvar init = function() {\n   mod.text.value = 'Step 1: Load a SVG vector, a PNG image or a HPGL file'\n   }\n//\n// inputs\n//\nvar inputs = {}\n//\n// outputs\n//\nvar outputs = {}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // text\n   //\n   var text = document.createElement('textarea')\n      text.style.backgroundColor='#D4E157';\n      text.setAttribute('rows',mods.ui.rows)\n      text.setAttribute('cols',mods.ui.cols)\n      div.appendChild(text)\n      mod.text = text\n   div.appendChild(document.createElement('br'))\n}\n//\n// local functions\n//\n;\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"624.2754320867882","left":"111.50847335423919","filename":"undefined","inputs":{},"outputs":{}},"0.6762574878660526":{"definition":"//\n// read HPGL\n//\n// Eyal Perry\n// (c) Massachusetts Institute of Technology 2021\n//\n// This work may be reproduced, modified, distributed, performed, and\n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is\n// provided as is; no warranty is provided, and users accept all\n// liability.\n//\n// closure\n//\n(function(){\n//\n// module globals\n//\nvar mod = {}\n//\n// name\n//\nvar name = 'read HPGL'\n//\n// initialization\n//\nvar init = function() {\n   }\n//\n// inputs\n//\nvar inputs = {\n   HPGL:{type:'string',\n      event:function(evt) {\n         hpgl_load_handler({target:{result:evt.detail}})\n       }}\n}\n//\n// outputs\n//\nvar outputs = {\n  toolpath:{type:'object',\n     event:function(){\n        cmd = {}\n        cmd.path = mod.path\n        cmd.name = mod.name\n        cmd.dpi = parseFloat(mod.dpitext.value)\n        cmd.width = mod.width\n        cmd.height = mod.height\n        mods.output(mod,'toolpath',cmd)\n        }}\n}\n//\n// interface\n//\nvar interface = function(div){\n   mod.div = div\n   //\n   // file input control\n   //\n   var file = document.createElement('input')\n      file.setAttribute('type','file')\n      file.setAttribute('id',div.id+'file_input')\n      file.style.position = 'absolute'\n      file.style.left = 0\n      file.style.top = 0\n      file.style.width = 0\n      file.style.height = 0\n      file.style.opacity = 0\n      file.addEventListener('change',function() {\n         hpgl_read_handler()\n         })\n      div.appendChild(file)\n      mod.file = file\n   //\n   // on-screen drawing canvas\n   //\n   var canvas = document.createElement('canvas')\n      canvas.width = mods.ui.canvas\n      canvas.height = mods.ui.canvas\n      canvas.style.backgroundColor = 'rgb(255,255,255)'\n      div.appendChild(canvas)\n      mod.canvas = canvas\n   div.appendChild(document.createElement('br'))\n   //\n   // off-screen image canvas\n   //\n   var canvas = document.createElement('canvas')\n      mod.img = canvas\n   //\n   // file select button\n   //\n   var btn = document.createElement('button')\n      btn.style.padding = mods.ui.padding\n      btn.style.margin = 1\n      btn.appendChild(document.createTextNode('select HPGL file'))\n      btn.addEventListener('click',function(){\n         var file = document.getElementById(div.id+'file_input')\n         file.value = null\n         file.click()\n         })\n      div.appendChild(btn)\n   div.appendChild(document.createElement('br'))\n   //\n   // info div\n   //\n   var info = document.createElement('div')\n      info.setAttribute('id',div.id+'info')\n      info.appendChild(document.createTextNode('dpi: '))\n      var input = document.createElement('input')\n         input.type = 'text'\n         input.size = 6\n         input.addEventListener('input',function(){\n            mod.dpi = parseFloat(mod.dpitext.value)\n            mod.mmtext.nodeValue = (25.4*mod.width/mod.dpi).toFixed(3)\n               +' x '+(25.4*mod.height/mod.dpi).toFixed(3)+' mm'\n            mod.intext.nodeValue = (mod.width/mod.dpi).toFixed(3)\n               +' x '+(mod.height/mod.dpi).toFixed(3)+' in'\n            outputs.toolpath.event()\n            })\n         info.appendChild(input)\n         mod.dpitext = input\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('px: ')\n         info.appendChild(text)\n         mod.pxtext = text\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('mm: ')\n         info.appendChild(text)\n         mod.mmtext = text\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('in: ')\n         info.appendChild(text)\n         mod.intext = text\n      info.appendChild(document.createElement('br'))\n      var text = document.createTextNode('')\n         info.appendChild(text)\n         mod.name = text\n      div.appendChild(info)\n   }\n//\n// local functions\n//\n// read handler\n//\nfunction hpgl_read_handler(event) {\n   //\n   // read as text\n   //\n   var file_reader = new FileReader()\n   file_reader.onload = hpgl_load_handler\n   var input_file = mod.file.files[0]\n   var file_name = input_file.name\n   mod.name.nodeValue = file_name\n   file_reader.readAsText(input_file)\n   }\n//\n// load handler\n//\nfunction hpgl_load_handler(event) {\n   var cmds = event.target.result.split(\";\");\n   var path = [];\n   for (var i = 0; i < cmds.length; i++) {\n     var cmd = cmds[i];\n     if (cmd.startsWith(\"IN\")) {\n       // initialize, start a plotting job\n     } else if (cmd.startsWith(\"SP\")) {\n       // select pen\n       //console.log(\"Select pen:\", cmd.substring(2));\n     } else if (cmd.startsWith(\"PU\")) {\n       // pen up\n       //console.log(\"Pen up\", cmd.substring(2));\n       var xy = cmd.substring(2).split(\",\");\n     } else if (cmd.startsWith(\"PD\")) {\n       // pen down\n       //console.log(\"Pen down:\", cmd.substring(2));\n       var pathRaw = cmd.substring(2).split(\",\");\n       var segment = [];\n       for (var j = 0; j < pathRaw.length; j += 2) {\n         segment.push([parseInt(pathRaw[j]), parseInt(pathRaw[j+1])])\n       }\n       path.push(segment);\n     }\n   }\n\n   if (path.length > 0 && path[0].length > 0){\n     //\n     // parse size\n     //\n     var minX = path[0][0][0];\n     var maxX = path[0][0][0];\n     var minY = path[0][0][1];\n     var maxY = path[0][0][1];\n     for (var segment in path) {\n       for (var i = 0; i < path[segment].length; i++) {\n         if (path[segment][i][0] < minX) minX = path[segment][i][0];\n         if (path[segment][i][0] > maxX) maxX = path[segment][i][0];\n         if (path[segment][i][1] < minY) minY = path[segment][i][1];\n         if (path[segment][i][1] > maxY) maxY = path[segment][i][1];\n       }\n     }\n     var x0 = minX;\n     var width = maxX-minX;\n     var y0 = minY;\n     var height = maxY-minY;\n     mod.width = width;\n     mod.height = height;\n     var dpi = Math.max(width, height) / 10\n     mod.dpitext.value = dpi.toFixed(3)\n     mod.pxtext.nodeValue = width+' x '+height+' px'\n     mod.mmtext.nodeValue = (25.4*width/dpi).toFixed(3)\n        +' x '+(25.4*height/dpi).toFixed(3)+' mm'\n     mod.intext.nodeValue = (width/dpi).toFixed(3)\n        +' x '+(height/dpi).toFixed(3)+' in'\n     //\n     // display\n     //\n     var scaleX = mod.canvas.width / width;\n     var scaleY = mod.canvas.height / height;\n     var scale = scaleX > scaleY ? scaleY : scaleX;\n\n     var ctx = mod.canvas.getContext('2d');\n     ctx.clearRect(0,0,mod.canvas.width,mod.canvas.height)\n\n     for (var segment in path) {\n       ctx.beginPath();\n       ctx.moveTo((path[segment][0][0] - x0) * scale, (path[segment][0][1] - y0) * scale);\n       for (var i = 1; i < path[segment].length; i++) {\n         ctx.lineTo((path[segment][i][0] - x0) * scale, (path[segment][i][1] - y0) * scale);\n       }\n       ctx.strokeStyle = \"red\";\n       ctx.stroke();\n     }\n\n     mod.path = path;\n     outputs.toolpath.event();\n   }\n\n\n}\n//\n// return values\n//\nreturn ({\n   mod:mod,\n   name:name,\n   init:init,\n   inputs:inputs,\n   outputs:outputs,\n   interface:interface\n   })\n}())\n","top":"1256.7142226358064","left":"312.0496815852006","filename":"modules/00%20read/hpgl.js","inputs":{},"outputs":{}},"0.3546929038664579":{"definition":"//\n// view toolpath\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// Modified by Francisco Sanchez Arroyo 27-March-2022 (r139)\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// todo:\n//    erase and update new path\n//    show depth info\n//    show size\n//    calculate camera far\n//\n// Fran notes:\n// From r125 you can no longer use the geometry contructor to create lines,\n// now you must use the buffer geometry constructor. The process is slightly\n// different.\n//\n//\n// closure\n//\n(function(){\n   //\n   // module globals\n   //\n   var mod = {}\n   //\n   // name\n   //\n   var name = 'view toolpath'\n   //\n   // initialization\n   //\n   var init = function() {\n      }\n   //\n   // inputs\n   //\n   var inputs = {\n      toolpath:{type:'object',\n         event:function(evt){\n            mod.path = evt.detail.path\n            mod.name = evt.detail.name\n            mod.dpi = evt.detail.dpi\n            mod.width = evt.detail.width\n            mod.height = evt.detail.height\n            mod.depth = evt.detail.depth\n            show_path_info()\n            show_path()\n            outputs.toolpath.event()\n            }}}\n   //\n   // outputs\n   //\n   var outputs = {\n      toolpath:{type:'object',\n         event:function(){\n            cmd = {}\n            cmd.path = mod.path\n            cmd.name = mod.name\n            cmd.dpi = mod.dpi\n            cmd.width = mod.width\n            cmd.height = mod.height\n            mods.output(mod,'toolpath',cmd)\n            }}}\n   //\n   // interface\n   //\n   var interface = function(div){\n      mod.div = div\n      //\n      // info\n      //\n      var text = document.createTextNode('name: ')\n         div.appendChild(text)\n         mod.nametext = text\n      div.appendChild(document.createElement('br'))\n      var text = document.createTextNode('(mm)')\n         div.appendChild(text)\n         mod.mmtext = text\n      div.appendChild(document.createElement('br'))\n      var text = document.createTextNode('(in)')\n         div.appendChild(text)\n         mod.intext = text\n      //\n      // view\n      //   \n      div.appendChild(document.createElement('br'))   \n      var btn = document.createElement('button')\n         btn.style.padding = mods.ui.padding\n         btn.style.margin = 1\n         var span = document.createElement('span')\n            var text = document.createTextNode('view')\n               span.appendChild(text)\n            btn.appendChild(span)\n         btn.addEventListener('click',function(){\n            open_view_window()\n            })\n         div.appendChild(btn)\n      }\n   //\n   // local functions\n   //\n   // show_path_info\n   //\n   function show_path_info() {\n      mod.nametext.nodeValue = 'name: '+mod.name\n      var width = (25.4*mod.width/mod.dpi).toFixed(3)\n      var height = (25.4*mod.height/mod.dpi).toFixed(3)\n      var depth = (25.4*mod.depth/mod.dpi).toFixed(3)\n      if (mod.depth == undefined)\n         mod.mmtext.nodeValue = width+' x '+height+' (mm)'\n      else\n         mod.mmtext.nodeValue = width+' x '+height+' x '+depth+' (mm)'\n      var width = (mod.width/mod.dpi).toFixed(3)\n      var height = (mod.height/mod.dpi).toFixed(3)\n      var depth = (mod.depth/mod.dpi).toFixed(3)\n      if (mod.depth == undefined)\n         mod.intext.nodeValue = width+' x '+height+' (in)'\n      else\n         mod.intext.nodeValue = width+' x '+height+' x '+depth+' (in)'\n      mods.fit(mod.div)\n      }\n   //\n   // show_path\n   //\n   function show_path() {\n      var scene = mod.scene\n      var camera = mod.camera\n      var renderer = mod.renderer\n      //\n      // check if view window open\n      //\n      if (mod.win == undefined) {\n         open_view_window()\n         return\n         }\n      //\n      // check for path\n      //\n      if (mod.path == undefined)\n         return\n      //\n      // clear scene, leave camera\n      //\n      var length = scene.children.length\n      for (var c = (length-1); c > 1; --c) {\n         scene.remove(scene.children[c])\n         }\n      //\n      // fit camera\n      //\n      mod.thetaxy = 0\n      mod.thetaz = 0\n      mod.r = mod.height/2\n      mod.x0 = mod.width/2\n      mod.y0 = mod.height/2\n      camera.position.set(mod.x0,mod.y0,mod.r)\n      camera.up = new THREE.Vector3(0,1,0)\n      camera.lookAt(new THREE.Vector3(mod.x0,mod.y0,0))\n      camera.updateProjectionMatrix()\n      //\n      // draw segments\n      //\n      var arrow_size = 1+mod.width/200\n      var path = mod.path\n      for (var segment = 0; segment < path.length; ++segment) {\n         if (segment > 0)\n            add_arrow(path[segment-1][path[segment-1].length-1],path[segment][0],0xff0000,arrow_size)         \n         for (var point = 1; point < path[segment].length; ++point) {\n            add_arrow(path[segment][point-1],path[segment][point],0x0000ff,arrow_size)\n            }\n         }\n      //\n      // add axes\n      //\n      var length = mod.height/10\n      add_arrow([0,0,0],[length,0,0],0xff0000,arrow_size)\n      add_arrow([0,0,0],[0,length,0],0x00ff00,arrow_size)\n      add_arrow([0,0,0],[0,0,length],0x0000ff,arrow_size)\n      //\n      // render\n      //\n      update()\n      //\n      // add_arrow\n      //\n      function add_arrow(start,stop,color,size) {\n         var origin = new THREE.Vector3().fromArray(start)\n         if (mod.depth == undefined)\n            origin.z = 0\n         var end  = new THREE.Vector3().fromArray(stop)\n         if (mod.depth == undefined)\n            end.z = 0\n         var length = new THREE.Vector3().subVectors(end,origin).length()\n         if (length <= size) {\n            add_line(origin,end,color)\n            //length = 1.1*size\n            return\n            }\n         var direction = new THREE.Vector3().subVectors(end,origin).normalize()\n         var arrow = new THREE.ArrowHelper(direction,origin,length,color,size,size)\n         scene.add(arrow)\n         }\n      //\n      // add_line\n      //\n      function add_line(start,stop,colorhex) {\n         var vertices = []\n         vertices.push(start,stop)\n         var geometry = new THREE.BufferGeometry().setFromPoints(vertices)\n         var material = new THREE.LineBasicMaterial({color:colorhex})\n         var line = new THREE.Line(geometry,material)\n         scene.add(line)\n         }\n      //\n      // update\n      //\n      function update() {\n         renderer.render(scene,camera)\n         }\n      }\n   //\n   // open_view_window\n   //\n   function open_view_window() {\n      //\n      // globals\n      //\n      var container,scene,camera,renderer,win,controls\n      //\n      // open the window\n      //\n      open_window()\n      //\n      // open_window\n      //\n      function open_window() {\n         //\n         // open window\n         //\n         win = window.open('')\n         mod.win = win\n         //\n         // load three.js\n         //\n         var script = document.createElement('script')\n         script.type = 'text/javascript'\n         script.onload = init_window\n         script.src = 'js/three.js/three.min.js'\n         mod.div.appendChild(script)\n         }\n      //\n      // init_window\n      //\n      function init_window() {\n         //\n         // close button\n         //\n         var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click',function(){\n               win.close()\n               mod.win = undefined\n               })\n            win.document.body.appendChild(btn)\n         //\n         // label text\n         //\n         var text = win.document.createTextNode(' left: pan, right: rotate, scroll: zoom')\n            win.document.body.appendChild(text)\n         //\n         // GL container\n         //\n         win.document.body.appendChild(document.createElement('br'))   \n         container = win.document.createElement('div')\n         container.style.overflow = 'hidden'\n         win.document.body.appendChild(container)\n         //\n         // event handlers\n         //\n         container.addEventListener('contextmenu',context_menu)\n         container.addEventListener('mousedown',mouse_down)\n         container.addEventListener('mouseup',mouse_up)\n         container.addEventListener('mousemove',mouse_move)\n         container.addEventListener('wheel',mouse_wheel)\n         //\n         // add scene\n         //\n         scene = new THREE.Scene()\n         mod.scene = scene\n         var width = win.innerWidth\n         var height = win.innerHeight\n         var aspect = width/height\n         var near = 0.1\n         var far = 1000000\n         camera = new THREE.PerspectiveCamera(90,aspect,near,far)\n         mod.camera = camera\n         scene.add(camera)\n         //\n         // add renderer\n         //\n         renderer = new THREE.WebGLRenderer({antialias:true})\n         mod.renderer = renderer\n         renderer.setClearColor(0xffffff)\n         renderer.setSize(width,height)\n         container.appendChild(renderer.domElement)\n         //\n         // show the path if available\n         //\n         show_path()\n         }\n      //\n      // context_menu\n      //\n      function context_menu(evt) {\n         evt.preventDefault()\n         evt.stopPropagation()\n         return (false)\n         }\n      //\n      // mouse_down\n      //\n      function mouse_down(evt) {\n         evt.preventDefault()\n         evt.stopPropagation()\n         mod.button = evt.button\n         mod.x = evt.clientX\n         mod.y = evt.clientY\n         }\n      //\n      // mouse_up\n      //\n      function mouse_up(evt) {\n         mod.button = undefined\n         mod.x = evt.clientX\n         mod.y = evt.clientY\n         }\n      //\n      // mouse_move\n      //\n      function mouse_move(evt) {\n         evt.preventDefault()\n         evt.stopPropagation()\n         var dx = evt.clientX-mod.x\n         var dy = evt.clientY-mod.y\n         mod.x = evt.clientX\n         mod.y = evt.clientY\n         if (mod.button == 0) {\n            mod.x0 += \n               Math.sin(mod.thetaz)*mod.height*dy/win.innerHeight\n               -Math.cos(mod.thetaz)*mod.width*dx/win.innerWidth\n            mod.y0 += \n               Math.cos(mod.thetaz)*mod.height*dy/win.innerHeight\n               +Math.sin(mod.thetaz)*mod.width*dx/win.innerWidth\n            camera.position.x = mod.x0+Math.sin(mod.thetaz)*mod.r*Math.sin(mod.thetaxy)\n            camera.position.y = mod.y0+Math.cos(mod.thetaz)*mod.r*Math.sin(mod.thetaxy)\n            camera.position.z = mod.r*Math.cos(mod.thetaxy)\n            camera.position.z = mod.r*Math.cos(mod.thetaxy)\n            camera.up = new THREE.Vector3(Math.sin(mod.thetaz),Math.cos(mod.thetaz),0)\n            camera.lookAt(new THREE.Vector3(mod.x0,mod.y0,0))\n            camera.updateProjectionMatrix()\n            renderer.render(scene,camera)\n            }\n         else if (mod.button == 2) {\n            mod.thetaxy += dy/win.innerHeight\n            mod.thetaz += dx/win.innerWidth\n            camera.position.x = mod.x0+Math.sin(mod.thetaz)*mod.r*Math.sin(mod.thetaxy)\n            camera.position.y = mod.y0+Math.cos(mod.thetaz)*mod.r*Math.sin(mod.thetaxy)\n            camera.position.z = mod.r*Math.cos(mod.thetaxy)\n            camera.up = new THREE.Vector3(Math.sin(mod.thetaz),Math.cos(mod.thetaz),0)\n            camera.lookAt(new THREE.Vector3(mod.x0,mod.y0,0))\n            camera.updateProjectionMatrix()\n            renderer.render(scene,camera)\n            }\n         }\n      //\n      // mouse_wheel\n      //\n      function mouse_wheel(evt) {\n         evt.preventDefault()\n         evt.stopPropagation()\n         var dy = evt.deltaY/win.innerHeight\n         mod.r += mod.height*dy\n         camera.position.x = mod.x0+Math.sin(mod.thetaz)*mod.r*Math.sin(mod.thetaxy)\n         camera.position.y = mod.y0+Math.cos(mod.thetaz)*mod.r*Math.sin(mod.thetaxy)\n         camera.position.z = mod.r*Math.cos(mod.thetaxy)\n         camera.lookAt(new THREE.Vector3(mod.x0,mod.y0,0))\n         camera.updateProjectionMatrix()\n         renderer.render(scene,camera)\n         }\n      }\n   //\n   // return values\n   //\n   return ({\n      name:name,\n      init:init,\n      inputs:inputs,\n      outputs:outputs,\n      interface:interface\n      })\n   }())\n   ","top":"953.2878479100159","left":"1776.962330252532","filename":"modules/10%20toolpath/30%20view/view%20toolpath.js","inputs":{},"outputs":{}},"0.6388377120191915":{"definition":"//\n// on-off module\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2020\n// Modified by Francisco Sanchez Arroyo 27-March-2022\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function() {\n    //\n    // module globals\n    //\n    var mod = {}\n    //\n    // name\n    //\n    var name = 'on/off'\n    //\n    // initialization\n    //\n    var init = function() {}\n    //\n    // inputs\n    //\n    var inputs = {\n        in: {\n            type: '',\n            event: function(evt) {\n                outputs.out.event(evt.detail)\n            }\n        }\n    }\n    //\n    // outputs\n    //\n    var outputs = {\n        out: {\n            type: '',\n            event: function(obj) {\n               checkSwitch(obj)\n            }\n        }\n    }\n    //\n    // interface\n    //\n    var interface = function(div) {\n        mod.div = div\n        var label = document.createElement('label')\n        label.className = 'switch'\n        var input = document.createElement('input')\n        input.type = 'checkbox'\n        input.checked = true\n        label.appendChild(input)\n        mod.switch = input\n        var span = document.createElement('span')\n        span.className = 'slider round'\n        label.appendChild(span)\n        div.appendChild(label)\n    }\n    //\n    // local functions\n    //\n\n    // switch\n    function checkSwitch(obj) {\n    if (mod.switch.checked) {\n       mods.output(mod, 'out', obj)\n    }\n    }\n\n\n    //\n    // return values\n    //\n    return ({\n        mod: mod,\n        name: name,\n        init: init,\n        inputs: inputs,\n        outputs: outputs,\n        interface: interface\n    })\n}())\n","top":"1086.7986463334967","left":"2658.7174847757174","filename":"modules/40%20ui/switch.js","inputs":{},"outputs":{}},"0.7524063949186837":{"definition":"//\n// read png\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2015,6\n// Modified by Fran Sanchez June 2021 (add flip v) and ChatGPT Feb 23 (add rotate cw)\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the fab modules \n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function() {\n    //\n    // module globals\n    //\n    var mod = {}\n    //\n    // name\n    //\n    var name = 'read png'\n    //\n    // initialization\n    //\n    var init = function() {}\n    //\n    // inputs\n    //\n    var inputs = {}\n    //\n    // outputs\n    //\n    var outputs = {\n        image: {\n            type: 'RGBA',\n            event: function() {\n                var ctx = mod.img.getContext(\"2d\")\n                var img = ctx.getImageData(0, 0, mod.img.width, mod.img.height)\n                mods.output(mod, 'image', img)\n            }\n        },\n        imageInfo: {\n            type: 'object',\n            event: function() {\n                var obj = {}\n                obj.name = mod.name.nodeValue\n                obj.dpi = parseFloat(mod.dpitext.value)\n                obj.width = mod.img.width\n                obj.height = mod.img.height\n                mods.output(mod, 'imageInfo', obj)\n            }\n        }\n    }\n    //\n    // interface\n    //\n    var interface = function(div) {\n        mod.div = div\n        //\n        // file input control\n        //\n        var file = document.createElement('input')\n        file.setAttribute('type', 'file')\n        file.setAttribute('id', div.id + 'file_input')\n        file.style.position = 'absolute'\n        file.style.left = 0\n        file.style.top = 0\n        file.style.width = 0\n        file.style.height = 0\n        file.style.opacity = 0\n        file.addEventListener('change', function() {\n            png_read_handler()\n        })\n        div.appendChild(file)\n        mod.file = file\n        //\n        // on-screen drawing canvas\n        //\n        var canvas = document.createElement('canvas')\n        canvas.width = mods.ui.canvas\n        canvas.height = mods.ui.canvas\n        canvas.style.backgroundColor = 'rgb(245,245,245)'\n        div.appendChild(canvas)\n        mod.canvas = canvas\n        div.appendChild(document.createElement('br'))\n        //\n        // off-screen image canvas\n        //\n        var canvas = document.createElement('canvas')\n        mod.img = canvas\n        //\n        // file select button\n        //\n        var btn = document.createElement('button')\n        btn.style.padding = mods.ui.padding\n        btn.style.margin = 1\n        btn.appendChild(document.createTextNode('select png file'))\n        btn.addEventListener('click', function() {\n            var file = document.getElementById(div.id + 'file_input')\n            file.value = null\n            file.click()\n        })\n        div.appendChild(btn)\n        div.appendChild(document.createElement('br'))\n        //\n        // view button\n        //\n        var btn = document.createElement('button')\n        btn.style.padding = mods.ui.padding\n        btn.style.margin = 1\n        btn.appendChild(document.createTextNode('view'))\n        btn.addEventListener('click', function() {\n            var win = window.open('')\n            var btn = document.createElement('button')\n            btn.appendChild(document.createTextNode('close'))\n            btn.style.padding = mods.ui.padding\n            btn.style.margin = 1\n            btn.addEventListener('click', function() {\n                win.close()\n            })\n            win.document.body.appendChild(btn)\n            win.document.body.appendChild(document.createElement('br'))\n            var canvas = document.createElement('canvas')\n            canvas.width = mod.img.width\n            canvas.height = mod.img.height\n            win.document.body.appendChild(canvas)\n            var ctx = canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img, 0, 0)\n        })\n        div.appendChild(btn)\n        div.appendChild(document.createTextNode(' '))\n        //\n        // invert button\n        //\n        var btn = document.createElement('button')\n        btn.style.padding = mods.ui.padding\n        btn.style.margin = 1\n        btn.appendChild(document.createTextNode('invert'))\n        btn.addEventListener('click', function() {\n            invert_image()\n        })\n        div.appendChild(btn)\n        div.appendChild(document.createElement('br'))\n        //\n        // flip button\n        //\n        var flip_btn = document.createElement('button')\n        flip_btn.style.padding = mods.ui.padding\n        flip_btn.style.margin = 1\n        flip_btn.appendChild(document.createTextNode('flip H'))\n        flip_btn.addEventListener('click', function() {\n            flip_image()\n        })\n        div.appendChild(flip_btn)\n        div.appendChild(document.createTextNode(' '))\n        //\n        //\n        // flipv button\n        //\n        var flipv_btn = document.createElement('button')\n        flipv_btn.style.padding = mods.ui.padding\n        flipv_btn.style.margin = 1\n        flipv_btn.appendChild(document.createTextNode('flip V'))\n        flipv_btn.addEventListener('click', function() {\n            flipv_image()\n        })\n        div.appendChild(flipv_btn)\n        div.appendChild(document.createTextNode(' '))\n        //\n        // rotate button\n        //\n        var rot_btn = document.createElement('button')\n        rot_btn.style.padding = mods.ui.padding\n        rot_btn.style.margin = 1\n        rot_btn.disabled = false\n        rot_btn.appendChild(document.createTextNode('rotate 90CW'))\n        rot_btn.addEventListener('click', function() {\n            rotate90cw_image()\n        })\n        div.appendChild(rot_btn)\n        div.appendChild(document.createElement('br'))\n        //\n        // info div\n        //\n        var info = document.createElement('div')\n        info.setAttribute('id', div.id + 'info')\n        info.appendChild(document.createTextNode('dpi: '))\n        var input = document.createElement('input')\n        input.type = 'text'\n        input.size = 6\n        input.addEventListener('input', function() {\n            mod.dpi = parseFloat(mod.dpitext.value)\n            mod.mmtext.nodeValue = (25.4 * mod.img.width / mod.dpi).toFixed(3) +\n                ' x ' + (25.4 * mod.img.height / mod.dpi).toFixed(3) + ' mm'\n            mod.intext.nodeValue = (mod.img.width / mod.dpi).toFixed(3) +\n                ' x ' + (mod.img.height / mod.dpi).toFixed(3) + ' in'\n            outputs.imageInfo.event()\n        })\n        info.appendChild(input)\n        mod.dpitext = input\n        info.appendChild(document.createElement('br'))\n        var text = document.createTextNode('px: ')\n        info.appendChild(text)\n        mod.pxtext = text\n        info.appendChild(document.createElement('br'))\n        var text = document.createTextNode('mm: ')\n        info.appendChild(text)\n        mod.mmtext = text\n        info.appendChild(document.createElement('br'))\n        var text = document.createTextNode('in: ')\n        info.appendChild(text)\n        mod.intext = text\n        info.appendChild(document.createElement('br'))\n        var text = document.createTextNode('')\n        info.appendChild(text)\n        mod.name = text\n        div.appendChild(info)\n    }\n    //\n    // local functions\n    //\n    // read handler\n    //\n    function png_read_handler(event) {\n        var file_reader = new FileReader()\n        file_reader.onload = png_binary_handler\n        input_file = mod.file.files[0]\n        file_name = input_file.name\n        mod.name.nodeValue = file_name\n        file_reader.readAsArrayBuffer(input_file)\n    }\n    //\n    // binary load handler\n    //\n    function png_binary_handler(event) {\n        //\n        // get DPI\n        //\n        // 8 header\n        // 4 len, 4 type, data, 4 crc\n        // pHYs 4 ppx, 4 ppy, 1 unit: 0 ?, 1 meter\n        // IEND\n        //\n        var units = ppx = ppy = 0\n        var buf = event.target.result\n        var view = new DataView(buf)\n        var ptr = 8\n        if (!((view.getUint8(1) == 80) && (view.getUint8(2) == 78) && (view.getUint8(3) == 71))) {\n            set_prompt(\"error: PNG header not found\")\n            return\n        }\n        while (1) {\n            var length = view.getUint32(ptr)\n            ptr += 4\n            var type = String.fromCharCode(\n                view.getUint8(ptr), view.getUint8(ptr + 1),\n                view.getUint8(ptr + 2), view.getUint8(ptr + 3))\n            ptr += 4\n            if (type == \"pHYs\") {\n                ppx = view.getUint32(ptr)\n                ppy = view.getUint32(ptr + 4)\n                units = view.getUint8(ptr + 8)\n            }\n            if (type == \"IEND\")\n                break\n            ptr += length + 4\n        }\n        if (units == 0) {\n            set_prompt(\"no PNG units not found, assuming 72 DPI\")\n            ppx = 72 * 1000 / 25.4\n        }\n        dpi = ppx * 25.4 / 1000\n        //\n        // read as URL for display\n        //\n        var file_reader = new FileReader()\n        file_reader.onload = png_URL_handler\n        file_reader.readAsDataURL(input_file)\n    }\n    //\n    // URL load handler\n    //\n    function png_URL_handler(event) {\n        var img = new Image()\n        img.setAttribute(\"src\", event.target.result)\n        img.onload = function() {\n            if (img.width > img.height) {\n                var x0 = 0\n                var y0 = mod.canvas.height * .5 * (1 - img.height / img.width)\n                var w = mod.canvas.width\n                var h = mod.canvas.width * img.height / img.width\n            } else {\n                var x0 = mod.canvas.width * .5 * (1 - img.width / img.height)\n                var y0 = 0\n                var w = mod.canvas.height * img.width / img.height\n                var h = mod.canvas.height\n            }\n            var ctx = mod.canvas.getContext(\"2d\")\n            ctx.clearRect(0, 0, mod.canvas.width, mod.canvas.height)\n            ctx.drawImage(img, x0, y0, w, h)\n            var ctx = mod.img.getContext(\"2d\")\n            ctx.canvas.width = img.width\n            ctx.canvas.height = img.height\n            ctx.drawImage(img, 0, 0)\n            mod.dpitext.value = dpi.toFixed(3)\n            mod.pxtext.nodeValue = img.width + ' x ' + img.height + ' px'\n            mod.mmtext.nodeValue = (25.4 * img.width / dpi).toFixed(3) +\n                ' x ' + (25.4 * img.height / dpi).toFixed(3) + ' mm'\n            mod.intext.nodeValue = (img.width / dpi).toFixed(3) +\n                ' x ' + (img.height / dpi).toFixed(3) + ' in'\n            outputs.image.event()\n            outputs.imageInfo.event()\n        }\n    }\n    //\n    // invert image\n    //\n    function invert_image() {\n        var blob = new Blob(['(' + worker.toString() + '())'])\n        var url = window.URL.createObjectURL(blob)\n        var webworker = new Worker(url)\n        webworker.addEventListener('message', function(evt) {\n            window.URL.revokeObjectURL(url)\n            var h = mod.img.height\n            var w = mod.img.width\n            var buf = new Uint8ClampedArray(evt.data.buffer) //canvas pixels contain 4 elements: RGBA\n            var imgdata = new ImageData(buf, w, h)\n            var ctx = mod.img.getContext(\"2d\")\n            ctx.putImageData(imgdata, 0, 0)\n            if (w > h) {\n                var x0 = 0\n                var y0 = mod.canvas.height * .5 * (1 - h / w)\n                var wd = mod.canvas.width\n                var hd = mod.canvas.width * h / w\n            } else {\n                var x0 = mod.canvas.width * .5 * (1 - w / h)\n                var y0 = 0\n                var wd = mod.canvas.height * w / h\n                var hd = mod.canvas.height\n            }\n            var ctx = mod.canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img, x0, y0, wd, hd)\n            webworker.terminate()\n            outputs.image.event()\n        })\n        var ctx = mod.canvas.getContext(\"2d\")\n        ctx.clearRect(0, 0, mod.canvas.width, mod.canvas.height)\n        var h = mod.img.height\n        var w = mod.img.width\n        var ctx = mod.img.getContext(\"2d\")\n        var img = ctx.getImageData(0, 0, w, h)\n        webworker.postMessage({\n            height: img.height,\n            width: img.width,\n            buffer: img.data.buffer\n        }, [img.data.buffer])\n    }\n\n    function worker() {\n        self.addEventListener('message', function(evt) {\n            var h = evt.data.height\n            var w = evt.data.width\n            var buf = new Uint8ClampedArray(evt.data.buffer)\n            for (var row = 0; row < h; ++row) {\n                for (var col = 0; col < w; ++col) {\n                    buf[(h - 1 - row) * w * 4 + col * 4 + 0] = 255 - buf[(h - 1 - row) * w * 4 + col * 4 + 0]\n                    buf[(h - 1 - row) * w * 4 + col * 4 + 1] = 255 - buf[(h - 1 - row) * w * 4 + col * 4 + 1]\n                    buf[(h - 1 - row) * w * 4 + col * 4 + 2] = 255 - buf[(h - 1 - row) * w * 4 + col * 4 + 2]\n                    buf[(h - 1 - row) * w * 4 + col * 4 + 3] = 255\n                }\n            }\n            self.postMessage({\n                buffer: buf.buffer\n            }, [buf.buffer])\n        })\n    }\n    //\n    // flip image\n    //\n    function flip_image() {\n        var blob = new Blob(['(' + flip_worker.toString() + '())'])\n        var url = window.URL.createObjectURL(blob)\n        var webworker = new Worker(url)\n        webworker.addEventListener('message', function(evt) {\n            window.URL.revokeObjectURL(url)\n            var h = mod.img.height\n            var w = mod.img.width\n            var buf = new Uint8ClampedArray(evt.data.buffer)\n            var imgdata = new ImageData(buf, w, h)\n            var ctx = mod.img.getContext(\"2d\")\n            ctx.putImageData(imgdata, 0, 0)\n            if (w > h) {\n                var x0 = 0\n                var y0 = mod.canvas.height * .5 * (1 - h / w)\n                var wd = mod.canvas.width\n                var hd = mod.canvas.width * h / w\n            } else {\n                var x0 = mod.canvas.width * .5 * (1 - w / h)\n                var y0 = 0\n                var wd = mod.canvas.height * w / h\n                var hd = mod.canvas.height\n            }\n            var ctx = mod.canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img, x0, y0, wd, hd)\n            webworker.terminate()\n            outputs.image.event()\n        })\n        var ctx = mod.canvas.getContext(\"2d\")\n        ctx.clearRect(0, 0, mod.canvas.width, mod.canvas.height)\n        var h = mod.img.height\n        var w = mod.img.width\n        var ctx = mod.img.getContext(\"2d\")\n        var img = ctx.getImageData(0, 0, w, h)\n        webworker.postMessage({\n            height: img.height,\n            width: img.width,\n            buffer: img.data.buffer\n        }, [img.data.buffer])\n    }\n\n    function flip_worker() {\n        self.addEventListener('message', function(evt) {\n            var h = evt.data.height\n            var w = evt.data.width\n            var buf = new Uint8ClampedArray(evt.data.buffer)\n            // image stored as RGBA array first row 0 of w*4 elements followed by row 1... until row h-1\n            var index = 0  // index for the 1D array image\n            for (var row = 0; row < h; ++row) {\n                for (var col = 0; col < w / 2; ++col) {\n                    index = row * w * 4 + col * 4    //  given row,col coordinates it returns its index in the 1D array\n                    r_index = row* w * 4 + (w - 1 - col) * 4 // the index where this value should be\n                    // Replace RGB values\n                    temp_1 = buf[index + 0]   //R\n                    temp_2 = buf[index + 1]   //G\n                    temp_3 = buf[index + 2]   //B\n                    buf[index + 0] = buf[r_index + 0]  //R\n                    buf[index + 1] = buf[r_index + 1]  //G\n                    buf[index + 2] = buf[r_index + 2]  //B\n                    buf[index + 3] = 255  //A\n                    buf[r_index + 0] = temp_1  //R\n                    buf[r_index + 1] = temp_2  //G\n                    buf[r_index + 2] = temp_3  //B  \n                    buf[r_index + 3] = 255  //A\n                }\n            }\n            self.postMessage({\n                buffer: buf.buffer\n            }, [buf.buffer])\n        })\n    }\n\n\n    //\n    // flip v image\n    //\n    function flipv_image() {\n        var blob = new Blob(['(' + flipv_worker.toString() + '())'])\n        var url = window.URL.createObjectURL(blob)\n        var webworker = new Worker(url)\n        webworker.addEventListener('message', function(evt) {\n            window.URL.revokeObjectURL(url)\n            var h = mod.img.height\n            var w = mod.img.width\n            var buf = new Uint8ClampedArray(evt.data.buffer)\n            var imgdata = new ImageData(buf, w, h)\n            var ctx = mod.img.getContext(\"2d\")\n            ctx.putImageData(imgdata, 0, 0)\n            if (w > h) {\n                var x0 = 0\n                var y0 = mod.canvas.height * .5 * (1 - h / w)\n                var wd = mod.canvas.width\n                var hd = mod.canvas.width * h / w\n            } else {\n                var x0 = mod.canvas.width * .5 * (1 - w / h)\n                var y0 = 0\n                var wd = mod.canvas.height * w / h\n                var hd = mod.canvas.height\n            }\n            var ctx = mod.canvas.getContext(\"2d\")\n            ctx.drawImage(mod.img, x0, y0, wd, hd)\n            webworker.terminate()\n            outputs.image.event()\n        })\n        var ctx = mod.canvas.getContext(\"2d\")\n        ctx.clearRect(0, 0, mod.canvas.width, mod.canvas.height)\n        var h = mod.img.height\n        var w = mod.img.width\n        var ctx = mod.img.getContext(\"2d\")\n        var img = ctx.getImageData(0, 0, w, h)\n        webworker.postMessage({\n            height: img.height,\n            width: img.width,\n            buffer: img.data.buffer\n        }, [img.data.buffer])\n    }\n\n    function flipv_worker() {\n        self.addEventListener('message', function(evt) {\n            var h = evt.data.height\n            var w = evt.data.width\n            var buf = new Uint8ClampedArray(evt.data.buffer)\n            var index = 0\n            for (var col = 0; col < w; ++col) {\n                for (var row = 0; row < h / 2; ++row) {\n                    index = row * w * 4 + col * 4\n                    r_index = (h - 1 - row) * w * 4 + col * 4\n                    temp_1 = buf[index + 0]\n                    temp_2 = buf[index + 1]\n                    temp_3 = buf[index + 2]\n                    buf[index + 0] = buf[r_index + 0]\n                    buf[index + 1] = buf[r_index + 1]\n                    buf[index + 2] = buf[r_index + 2]\n                    buf[r_index + 0] = temp_1\n                    buf[r_index + 1] = temp_2\n                    buf[r_index + 2] = temp_3\n                    buf[index + 3] = 255\n                    buf[r_index + 3] = 255\n                }\n            }\n            self.postMessage({\n                buffer: buf.buffer\n            }, [buf.buffer])\n        })\n    }\n\n    //\n    // rotate image 90 CW by ChatGPT\n    //\n    function rotate90cw_worker() {\n        // by ChatGPT\n        self.addEventListener('message', function(evt) {\n            var h = evt.data.height;\n            var w = evt.data.width;\n            var img = new ImageData(new Uint8ClampedArray(evt.data.buffer), w, h);\n            var rotated = new ImageData(new Uint8ClampedArray(w * h * 4), h, w);\n    \n            for (var y = 0; y < h; y++) {\n                for (var x = 0; x < w; x++) {\n                    var srcPos = (y * w + x) * 4;\n                    var destPos = (x * h + (h - y - 1)) * 4;\n                    rotated.data[destPos + 0] = img.data[srcPos + 0];\n                    rotated.data[destPos + 1] = img.data[srcPos + 1];\n                    rotated.data[destPos + 2] = img.data[srcPos + 2];\n                    rotated.data[destPos + 3] = img.data[srcPos + 3];\n                }\n            }\n    \n            self.postMessage({\n                height: rotated.height,\n                width: rotated.width,\n                buffer: rotated.data.buffer\n            }, [rotated.data.buffer]);\n        });\n    }\n    \n\n\n    function rotate90cw_image() {\n        // by ChatGPT\n        var blob = new Blob(['(' + rotate90cw_worker.toString() + '())'])\n        var url = window.URL.createObjectURL(blob)\n        var webworker = new Worker(url)\n        webworker.addEventListener('message', function(evt) {\n            window.URL.revokeObjectURL(url)\n            var h = evt.data.height\n            var w = evt.data.width\n            var buf = new Uint8ClampedArray(evt.data.buffer)\n            var imgdata = new ImageData(buf, w, h)\n            var canvas = mod.img\n            canvas.width = w\n            canvas.height = h\n            var ctx = canvas.getContext(\"2d\")\n            ctx.putImageData(imgdata, 0, 0)\n            if (w > h) {\n                var x0 = 0\n                var y0 = mod.canvas.height * .5 * (1 - h / w)\n                var wd = mod.canvas.width\n                var hd = mod.canvas.width * h / w\n            } else {\n                var x0 = mod.canvas.width * .5 * (1 - w / h)\n                var y0 = 0\n                var wd = mod.canvas.height * w / h\n                var hd = mod.canvas.height\n            }\n            var ctx = mod.canvas.getContext(\"2d\")\n            ctx.clearRect(0, 0, mod.canvas.width, mod.canvas.height)\n            ctx.drawImage(canvas, x0, y0, wd, hd)\n            webworker.terminate()\n            outputs.image.event()\n        })\n        var canvas = mod.canvas\n        var ctx = canvas.getContext(\"2d\")\n        ctx.clearRect(0, 0, canvas.width, canvas.height)\n        var h = mod.img.height\n        var w = mod.img.width\n        var ctx = mod.img.getContext(\"2d\")\n        var img = ctx.getImageData(0, 0, w, h)\n        webworker.postMessage({\n            height: img.height,\n            width: img.width,\n            buffer: img.data.buffer\n        }, [img.data.buffer])\n    }\n         \n    //\n    // return values\n    //\n    return ({\n        name: name,\n        init: init,\n        inputs: inputs,\n        outputs: outputs,\n        interface: interface\n    })\n}())\n","top":"736.4728048930325","left":"320.87408535352984","filename":"undefined","inputs":{},"outputs":{}},"0.8059434686272178":{"definition":"//\n// WebSerial module\n//\n// Neil Gershenfeld \n// (c) Massachusetts Institute of Technology 2016\n// Modified by Fran Sanchez & Leo McElroy 12 Jan 2023\n// \n// This work may be reproduced, modified, distributed, performed, and \n// displayed for any purpose, but must acknowledge the mods\n// project. Copyright is retained and must be preserved. The work is \n// provided as is; no warranty is provided, and users accept all \n// liability.\n//\n// closure\n//\n(function() {\n    //\n    // module globals\n    //\n    var mod = {}\n    //\n    // name\n    //\n    var name = 'WebSerial'\n    //\n    // initialization\n    //\n    var init = function() {\n        mod.baud.value = '9600'\n        mod.flow_rtscts.checked = true\n    }\n    //\n    // inputs\n    //\n    var inputs = {\n        object: {\n            type: 'object',\n            event: function(evt) {\n                if (evt.detail.type == 'command') {\n                    mod.command = evt.detail.contents\n                    data_send(mod.command)\n                } else if (evt.detail.type == 'file') {\n                    mod.job = evt.detail.contents\n                    mod.job.type = 'file'\n                    mod.label.nodeValue = 'send file'\n                    mod.labelspan.style.fontWeight = 'bold'\n                }\n            }\n        }\n\n    }\n    //\n    // outputs\n    //\n    var outputs = {\n        Monitor: {\n            type: 'text',\n            event: function() {\n                mods.output(mod, 'text', result)\n            }\n        }\n    }\n    //\n    // interface\n    //\n    var interface = function(div) {\n        mod.div = div\n        div.appendChild(document.createTextNode('WebSerial:'))\n        div.appendChild(document.createElement('br'))\n        \n        var btn = document.createElement('button')\n        btn.style.margin = 1\n        btn.appendChild(document.createTextNode('Get Device'))\n        btn.addEventListener('click', function() {\n             webserial_getdevices()\n        })\n        div.appendChild(btn)\n        var btn = document.createElement('button')\n        btn.style.margin = 1\n        btn.appendChild(document.createTextNode('Forget'))\n        btn.addEventListener('click', function() {\n          webserial_forget()\n        })\n        div.appendChild(btn)\n\n\n\n\n        div.appendChild(document.createElement('hr'))\n\n        //\n        // baud rate\n        //\n        div.appendChild(document.createTextNode('baud rate: '))\n        var input = document.createElement('input')\n        input.type = 'text'\n        input.size = 7\n        div.appendChild(input)\n        mod.baud = input\n        div.appendChild(document.createTextNode(' (bps)'))\n        div.appendChild(document.createElement('hr'))\n\n        //\n        // flow control\n        //\n        div.appendChild(document.createTextNode('flow control:'))\n        div.appendChild(document.createElement('br'))\n        var input = document.createElement('input')\n        input.type = 'radio'\n        input.name = mod.div.id + 'flow'\n        input.id = mod.div.id + 'flow_none'\n        div.appendChild(input)\n        mod.flow_none = input\n        div.appendChild(document.createTextNode('none\\u00a0\\u00a0\\u00a0'))\n        var input = document.createElement('input')\n        input.type = 'radio'\n        input.name = mod.div.id + 'flow'\n        input.id = mod.div.id + 'flow_rtscts'\n        div.appendChild(input)\n        mod.flow_rtscts = input\n        mod.flow_rtscts.checked = true\n        div.appendChild(document.createTextNode('RTSCTS\\u00a0'))\n        //\n        // send button\n        //\n        div.appendChild(document.createElement('hr'))\n        var btn = document.createElement('button')\n        btn.style.margin = 1\n        //btn.disabled = true\n        var span = document.createElement('span')\n        var text = document.createTextNode('waiting for file')        \n        mod.label = text\n        span.appendChild(text)\n        mod.labelspan = span\n        btn.appendChild(span)\n        btn.addEventListener('click', function() {\n          data_send(mod.job)\n          mod.label.nodeValue = 'waiting for file'\n          mod.labelspan.style.fontWeight = 'normal'\n})\n        div.appendChild(btn)\n\n\n\n    }\n    //\n    // local functions\n    //\n\n    function check_flow() {\n        //\n        // Checks the flow control settings\n        //\n        if (mod.flow_rtscts.checked) {\n            mod.flowControl = \"hardware\"\n            console.log('hardware RTSCTS flow control')\n        } else {\n            mod.flowControl = \"none\"\n            console.log('no flow control')\n        } \n    }\n\n    async function readPort(port) {\n\n        console.log(\"trying to read port\");\n        try  {\n            console.log(\"port is readable\", port.readable);\n\n            while (port.readable) {\n                console.log(\"reading port\", port.readable);\n                reader = port.readable.getReader();\n\n                while (true) {\n                    const { value, done } = await reader.read();\n                    if (value) {\n                        const data = new Uint8Array(value.length);\n                        for (let i = 0; i < value.length; i++) {\n                            data[i] = value[i];\n                        }\n                    \n                        const str = new TextDecoder().decode(data); \n\n                        // do something with data here\n                        console.log(str);\n                    }\n\n                    if (done) {\n                        reader.releaseLock();\n                        break;\n                    }\n                }\n            }\n\n            console.log(\"port not readable\");\n\n        } catch (err) {\n            console.log(\"caught\", err);\n        } \n        // finally {\n        //     await port.close();\n        //     console.log(\"port closed\");\n        // }\n    }\n\n    let port;\n    let reader;\n\n    // disconnect webserial device\n    async function webserial_forget() {\n        if (!port) return;\n        if (port.readable.locked) {\n            reader.releaseLock();\n            reader = null;\n        }\n        await port.close();\n        console.log(\"Port closed\");\n    }\n\n    // connect webserial device\n    async function webserial_getdevices() {\n        check_flow()\n        port = await navigator.serial.requestPort();\n        await port.open({ baudRate: parseInt(mod.baud.value), flowControl: mod.flowControl });\n        console.log(\"Port opened\");\n\n        readPort(port);\n\n        }\n\n    \n    // send data to webserial device\n    async function data_send(msg) {\n        result = []\n        console.log(\"sending message\", msg);\n        // split msg into a characters array\n        for(let i = 0; i < msg.length; i++){\n            let code = msg.charCodeAt(i);\n            result.push(code);\n        } \n        console.log(result);\n        // convert the array into Uinst8Array\n        result = Uint8Array.from(result)\n        console.log(result);\n        // write the result to webserial\n        try {const writer = port.writable.getWriter();\n        await writer.write(result);\n        writer.releaseLock();} catch (error) {console.log(\"port not opened\")}\n    }\n    //\n    // return values\n    //\n    return ({\n        mod: mod,\n        name: name,\n        init: init,\n        inputs: inputs,\n        outputs: outputs,\n        interface: interface\n    })\n}())\n","top":"1114.4499816589005","left":"3119.9016468545415","filename":"modules/webserial/webserial.js","inputs":{},"outputs":{}}},"links":["{\"source\":\"{\\\"id\\\":\\\"0.07944144280928633\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"image\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.8903773266711255\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"image\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.47383876715576023\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"distances\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.3135579179893032\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"distances\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.3135579179893032\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"image\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.07944144280928633\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"image\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.17844113591127098\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"offset\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.3135579179893032\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"offset\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.6488303557466412\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"image\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.47383876715576023\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"image\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.8903773266711255\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"image\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.749132408760488\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"image\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.749132408760488\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"path\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.17844113591127098\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"path\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.0006820493131942662\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"SVG\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.07794749880174023\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"SVG\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.07794749880174023\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"image\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.6488303557466412\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"image\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.07794749880174023\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"imageInfo\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.17844113591127098\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"imageInfo\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.45864332974522226\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"settings\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.006161897402890748\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"settings\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.006161897402890748\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"file\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.6388377120191915\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"in\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.3546929038664579\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"toolpath\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.006161897402890748\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"path\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.17844113591127098\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"toolpath\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.3546929038664579\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"toolpath\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.6762574878660526\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"toolpath\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.3546929038664579\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"toolpath\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.7524063949186837\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"image\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.6488303557466412\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"image\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.7524063949186837\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"imageInfo\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.17844113591127098\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"imageInfo\\\"}\"}","{\"source\":\"{\\\"id\\\":\\\"0.6388377120191915\\\",\\\"type\\\":\\\"outputs\\\",\\\"name\\\":\\\"out\\\"}\",\"dest\":\"{\\\"id\\\":\\\"0.8059434686272178\\\",\\\"type\\\":\\\"inputs\\\",\\\"name\\\":\\\"object\\\"}\"}"]}